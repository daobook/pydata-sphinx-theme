
<!DOCTYPE html>

<html lang="zh_CN">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="generator" content="Docutils 0.17.1: http://docutils.sourceforge.net/" />
<meta content="An example of a long HTML page, as is coming in the pandas documentation in pydata-sphinx-theme." lang="en" name="description" xml:lang="en" />

    <title>Pandas example - Indexing and selecting data &#8212; PyData Sphinx Theme 0.8.1 文档</title>
    <script>
      document.documentElement.dataset.mode = localStorage.getItem("mode") || "";
      document.documentElement.dataset.theme = localStorage.getItem("theme") || "light"
    </script>
    
  <!-- Loaded before other Sphinx assets -->
  <link href="../_static/styles/theme.css?digest=fb52004a9691e5b75515" rel="stylesheet">
<link href="../_static/styles/pydata-sphinx-theme.css?digest=fb52004a9691e5b75515" rel="stylesheet">

    
  <link rel="stylesheet"
    href="../_static/vendor/fontawesome/5.13.0/css/all.min.css">
  <link rel="preload" as="font" type="font/woff2" crossorigin
    href="../_static/vendor/fontawesome/5.13.0/webfonts/fa-solid-900.woff2">
  <link rel="preload" as="font" type="font/woff2" crossorigin
    href="../_static/vendor/fontawesome/5.13.0/webfonts/fa-brands-400.woff2">

    <link rel="stylesheet" type="text/css" href="../_static/pygments.css" />
    <link rel="stylesheet" type="text/css" href="../_static/jupyter-sphinx.css" />
    <link rel="stylesheet" type="text/css" href="../_static/thebelab.css" />
    <link rel="stylesheet" type="text/css" href="../_static/custom.css" />
    
  <!-- Pre-loaded scripts that we'll load fully later -->
  <link rel="preload" as="script" href="../_static/scripts/pydata-sphinx-theme.js?digest=fb52004a9691e5b75515">

    <script data-url_root="../" id="documentation_options" src="../_static/documentation_options.js"></script>
    <script src="../_static/jquery.js"></script>
    <script src="../_static/underscore.js"></script>
    <script src="../_static/doctools.js"></script>
    <script src="../_static/thebelab-helper.js"></script>
    <script src="../_static/translations.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.4/require.min.js"></script>
    <script src="https://unpkg.com/@jupyter-widgets/html-manager@^0.20.1/dist/embed-amd.js"></script>
    <link rel="canonical" href="http://127.0.0.1:8000/demo/example_pandas.html" />
    <link rel="index" title="索引" href="../genindex.html" />
    <link rel="search" title="搜索" href="../search.html" />
    <link rel="next" title="1. Test of no sidebar" href="no-sidebar.html" />
    <link rel="prev" title="pandas.Series.array" href="generated/pandas.Series.array.html" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <meta name="docsearch:language" content="zh_CN">
    

    <!-- Google Analytics -->
    
  </head>
  <body data-spy="scroll" data-target="#bd-toc-nav" data-offset="60" data-default-mode="">
    
    <div class="container-fluid" id="banner"></div>

    
    <nav class="navbar navbar-light navbar-expand-lg bg-light fixed-top bd-navbar" id="navbar-main"><div class="container-xl">

  <div id="navbar-start">
    
    
<a class="navbar-brand" href="../index.html">
<p class="title">PyData Sphinx Theme</p>
</a>

    
  </div>

  <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbar-collapsible" aria-controls="navbar-collapsible" aria-expanded="false" aria-label="Toggle navigation">
    <span class="fas fa-bars"></span>
  </button>

  
  <div id="navbar-collapsible" class="col-lg-9 collapse navbar-collapse">
    <div id="navbar-center" class="mr-auto">
      
      <div class="navbar-center-item">
        <ul id="navbar-main-elements" class="navbar-nav">
    <li class="toctree-l1 nav-item">
 <a class="reference internal nav-link" href="../user_guide/index.html">
  用户指南
 </a>
</li>

<li class="toctree-l1 nav-item">
 <a class="reference internal nav-link" href="../contribute/index.html">
  贡献
 </a>
</li>

<li class="toctree-l1 current active nav-item">
 <a class="reference internal nav-link" href="index.html">
  Demo site
 </a>
</li>

    
    <li class="nav-item">
        <a class="nav-link nav-external" href="https://github.com/pydata/pydata-sphinx-theme/releases">Changelog<i class="fas fa-external-link-alt"></i></a>
    </li>
    
    <li class="nav-item">
        <a class="nav-link nav-external" href="https://pandas.pydata.org/pandas-docs/stable/">Pandas Docs<i class="fas fa-external-link-alt"></i></a>
    </li>
    
</ul>
      </div>
      
    </div>

    <div id="navbar-end">
      
      <div class="navbar-end-item">
        <span id="theme-switch" class="btn btn-sm btn-outline-primary navbar-btn rounded-circle">
    <a class="theme-switch" data-mode="light"><i class="fas fa-sun"></i></a>
    <a class="theme-switch" data-mode="dark"><i class="far fa-moon"></i></a>
    <a class="theme-switch" data-mode="auto"><i class="fas fa-adjust"></i></a>
</span>
      </div>
      
      <div class="navbar-end-item">
        <div class="dropdown" id="version_switcher">
    <button type="button" class="btn btn-primary btn-sm navbar-btn dropdown-toggle" id="version_switcher_button" data-toggle="dropdown">
        v0.8.1  <!-- this text may get changed later by javascript -->
        <span class="caret"></span>
    </button>
    <div id="version_switcher_menu" class="dropdown-menu list-group-flush py-0" aria-labelledby="version_switcher_button">
    <!-- dropdown will be populated by javascript on page load -->
    </div>
</div>

<!-- NOTE: this JS must live here (not in our global JS file) because it relies
     on being processed by Jinja before it is run (specifically for replacing
     variables demo/example_pandas and {'json_url': 'https://daobook.github.io/pydata-sphinx-theme/_static/switcher.json', 'version_match': 'v0.8.1'}.
-->

<script type="text/javascript">
// Check if corresponding page path exists in other version of docs
// and, if so, go there instead of the homepage of the other docs version
function checkPageExistsAndRedirect(event) {
    const currentFilePath = "demo/example_pandas.html",
          tryUrl = event.target.getAttribute("href");
    let otherDocsHomepage = tryUrl.replace(currentFilePath, "");
    $.ajax({
        type: 'HEAD',
        url: tryUrl,
        // if the page exists, go there
        success: function() {
            location.href = tryUrl;
        }
    }).fail(function() {
        location.href = otherDocsHomepage;
    });
    // this prevents the browser from following the href of the clicked node
    // (which is fine because this function takes care of redirecting)
    return false;
}

// Populate the version switcher from the JSON config file
(function () {
    $.getJSON("https://daobook.github.io/pydata-sphinx-theme/_static/switcher.json", function(data, textStatus, jqXHR) {
        const currentFilePath = "demo/example_pandas.html";
        // create links to the corresponding page in the other docs versions
        $.each(data, function(index, entry) {
            // if no custom name specified (e.g., "latest"), use version string
            if (!("name" in entry)) {
                entry.name = entry.version;
            }
            // create the node
            const node = document.createElement("a");
            node.setAttribute("class", "list-group-item list-group-item-action py-1");
            node.textContent = `${entry.name}`;
            node.setAttribute("href", `${entry.url}${currentFilePath}`);
            // on click, AJAX calls will check if the linked page exists before
            // trying to redirect, and if not, will redirect to the homepage
            // for that version of the docs.
            node.onclick = checkPageExistsAndRedirect;
            // Add dataset values for the version and name in case people want
            // to apply CSS styling based on this information.
            node.dataset["versionName"] = entry.name;
            node.dataset["version"] = entry.version;

            $("#version_switcher_menu").append(node);
            // replace dropdown button text with the preferred display name of
            // this version, rather than using sphinx's  variable.
            // also highlight the dropdown entry for the currently-viewed
            // version's entry
            if (entry.version == "v0.8.1") {
                node.classList.add("active");
                let btn = document.getElementById("version_switcher_button");
                btn.innerText = btn.dataset["activeVersionName"] = entry.name;
                btn.dataset["activeVersion"] = entry.version;
            }
        });
    });
})();
</script>
      </div>
      
      <div class="navbar-end-item">
        <ul id="navbar-icon-links" class="navbar-nav" aria-label="Icon Links">
        <li class="nav-item">
          <a class="nav-link" href="https://github.com/pydata/pydata-sphinx-theme" rel="noopener" target="_blank" title="GitHub"><span><i class="fab fa-github-square"></i></span>
            <label class="sr-only">GitHub</label></a>
        </li>
        <li class="nav-item">
          <a class="nav-link" href="https://twitter.com/pandas_dev" rel="noopener" target="_blank" title="Twitter"><span><i class="fab fa-twitter-square"></i></span>
            <label class="sr-only">Twitter</label></a>
        </li>
        <li class="nav-item">
          <a class="nav-link" href="https://pypi.org/project/pydata-sphinx-theme" rel="noopener" target="_blank" title="PyPI"><span><i class="fas fa-box"></i></span>
            <label class="sr-only">PyPI</label></a>
        </li>
        <li class="nav-item">
          <a class="nav-link" href="https://pandas.pydata.org" rel="noopener" target="_blank" title="Pandas"><img src="../_static/pandas-square.svg" class="icon-link-image" alt="Pandas"/></a>
        </li>
      </ul>
      </div>
      
    </div>
  </div>
</div>
    </nav>
    

    <div class="container-xl">
      <div class="row">
          
            
            <!-- Only show if we have sidebars configured, else just a small margin  -->
            <div class="col-12 col-md-3 bd-sidebar">
              <div class="sidebar-start-items"><form class="bd-search d-flex align-items-center" action="../search.html" method="get">
  <i class="icon fas fa-search"></i>
  <input type="search" class="form-control" name="q" id="search-input" placeholder="Search the docs ..." aria-label="Search the docs ..." autocomplete="off" >
</form><nav class="bd-links" id="bd-docs-nav" aria-label="Main navigation">
  <div class="bd-toc-item active">
    <p aria-level="2" class="caption" role="heading">
 <span class="caption-text">
  Demo Documentation
 </span>
</p>
<ul class="current nav bd-sidenav">
 <li class="toctree-l1 has-children">
  <a class="reference internal" href="kitchen-sink/index.html">
   Kitchen Sink
  </a>
  <input class="toctree-checkbox" id="toctree-checkbox-1" name="toctree-checkbox-1" type="checkbox"/>
  <label for="toctree-checkbox-1">
   <i class="fas fa-chevron-down">
   </i>
  </label>
  <ul>
   <li class="toctree-l2">
    <a class="reference internal" href="kitchen-sink/paragraph-markup.html">
     Paragraph Level Markup
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="kitchen-sink/api.html">
     API documentation
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="kitchen-sink/lists-and-tables.html">
     Lists &amp; Tables
    </a>
   </li>
  </ul>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="theme-elements.html">
   Theme-specific elements
  </a>
 </li>
 <li class="toctree-l1 has-children">
  <a class="reference internal" href="api.html">
   Advanced API documentation and generated content
  </a>
  <input class="toctree-checkbox" id="toctree-checkbox-2" name="toctree-checkbox-2" type="checkbox"/>
  <label for="toctree-checkbox-2">
   <i class="fas fa-chevron-down">
   </i>
  </label>
  <ul>
   <li class="toctree-l2">
    <a class="reference internal" href="generated/pandas.DataFrame.drop.html">
     pandas.DataFrame.drop
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="generated/pandas.DataFrame.groupby.html">
     pandas.DataFrame.groupby
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="generated/pandas.Series.array.html">
     pandas.Series.array
    </a>
   </li>
  </ul>
 </li>
 <li class="toctree-l1 current active">
  <a class="current reference internal" href="#">
   Pandas example - Indexing and selecting data
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference external" href="https://jupyterbook.org/">
   Link to an external site
  </a>
 </li>
</ul>
<p aria-level="2" class="caption" role="heading">
 <span class="caption-text">
  This is an incredibly long caption for a long menu. Here are some more subpages to show off deep nested pages.
 </span>
</p>
<ul class="nav bd-sidenav">
 <li class="toctree-l1">
  <a class="reference internal" href="no-sidebar.html">
   1. Test of no sidebar
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="mult_headers.html">
   2. Top-level headers and the TOC
  </a>
 </li>
 <li class="toctree-l1 has-children">
  <a class="reference internal" href="subpages/index.html">
   5. Section to show off pages with many sub-pages
  </a>
  <input class="toctree-checkbox" id="toctree-checkbox-3" name="toctree-checkbox-3" type="checkbox"/>
  <label for="toctree-checkbox-3">
   <i class="fas fa-chevron-down">
   </i>
  </label>
  <ul>
   <li class="toctree-l2">
    <a class="reference internal" href="subpages/subpage1.html">
     5.1. Sub-page 1
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="subpages/subpage2.html">
     5.2. Sub-page 2
    </a>
   </li>
   <li class="toctree-l2 has-children">
    <a class="reference internal" href="subpages/subsubpages/index.html">
     5.3. Section with sub-sub-pages
    </a>
    <input class="toctree-checkbox" id="toctree-checkbox-4" name="toctree-checkbox-4" type="checkbox"/>
    <label for="toctree-checkbox-4">
     <i class="fas fa-chevron-down">
     </i>
    </label>
    <ul>
     <li class="toctree-l3">
      <a class="reference internal" href="subpages/subsubpages/subsubpage1.html">
       5.3.1. Sub-sub-page 1
      </a>
     </li>
     <li class="toctree-l3">
      <a class="reference internal" href="subpages/subsubpages/subsubpage2.html">
       5.3.2. Sub-sub-page 2
      </a>
     </li>
     <li class="toctree-l3">
      <a class="reference internal" href="subpages/subsubpages/subsubpage3.html">
       5.3.3. Sub-sub-page 3
      </a>
     </li>
     <li class="toctree-l3">
      <a class="reference internal" href="subpages/subsubpages/subsubpage4.html">
       5.3.4. Sub-sub-page 4
      </a>
     </li>
     <li class="toctree-l3">
      <a class="reference internal" href="subpages/subsubpages/subsubpage5.html">
       5.3.5. Sub-sub-page 5
      </a>
     </li>
     <li class="toctree-l3">
      <a class="reference internal" href="subpages/subsubpages/subsubpage6.html">
       5.3.6. Sub-sub-page 6
      </a>
     </li>
     <li class="toctree-l3">
      <a class="reference internal" href="subpages/subsubpages/subsubpage7.html">
       5.3.7. Sub-sub-page 7
      </a>
     </li>
     <li class="toctree-l3">
      <a class="reference internal" href="subpages/subsubpages/subsubpage8.html">
       5.3.8. Sub-sub-page 8
      </a>
     </li>
     <li class="toctree-l3">
      <a class="reference internal" href="subpages/subsubpages/subsubpage9.html">
       5.3.9. Sub-sub-page 9
      </a>
     </li>
     <li class="toctree-l3">
      <a class="reference internal" href="subpages/subsubpages/subsubpage10.html">
       5.3.10. Sub-sub-page 10
      </a>
     </li>
     <li class="toctree-l3">
      <a class="reference internal" href="subpages/subsubpages/subsubpage11.html">
       5.3.11. Sub-sub-page 11
      </a>
     </li>
     <li class="toctree-l3">
      <a class="reference internal" href="subpages/subsubpages/subsubpage12.html">
       5.3.12. Sub-sub-page 12
      </a>
     </li>
     <li class="toctree-l3">
      <a class="reference internal" href="subpages/subsubpages/subsubpage13.html">
       5.3.13. Sub-sub-page 13
      </a>
     </li>
     <li class="toctree-l3">
      <a class="reference internal" href="subpages/subsubpages/subsubpage14.html">
       5.3.14. Sub-sub-page 14
      </a>
     </li>
     <li class="toctree-l3">
      <a class="reference internal" href="subpages/subsubpages/subsubpage15.html">
       5.3.15. Sub-sub-page 15
      </a>
     </li>
     <li class="toctree-l3">
      <a class="reference internal" href="subpages/subsubpages/subsubpage16.html">
       5.3.16. Sub-sub-page 16
      </a>
     </li>
     <li class="toctree-l3">
      <a class="reference internal" href="subpages/subsubpages/subsubpage17.html">
       5.3.17. Sub-sub-page 17
      </a>
     </li>
     <li class="toctree-l3">
      <a class="reference internal" href="subpages/subsubpages/subsubpage18.html">
       5.3.18. Sub-sub-page 18
      </a>
     </li>
     <li class="toctree-l3">
      <a class="reference internal" href="subpages/subsubpages/subsubpage19.html">
       5.3.19. Sub-sub-page 19
      </a>
     </li>
     <li class="toctree-l3">
      <a class="reference internal" href="subpages/subsubpages/subsubpage20.html">
       5.3.20. Sub-sub-page 20
      </a>
     </li>
    </ul>
   </li>
  </ul>
 </li>
</ul>

  </div>
</nav>
              </div>
              <div class="sidebar-end-items">
              </div>
            </div>
            
          

          
          <div class="d-none d-xl-block col-xl-2 bd-toc">
            
              
              <div class="toc-item">
                
<div class="tocsection onthispage mt-5 pt-1 pb-3">
    <i class="fas fa-list"></i> On this page
</div>

<nav id="bd-toc-nav">
    <ul class="visible nav section-nav flex-column">
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#different-choices-for-indexing">
   Different choices for indexing
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#basics">
   Basics
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#attribute-access">
   Attribute access
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#selection-by-label">
   Selection by label
  </a>
  <ul class="nav section-nav flex-column">
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#slicing-with-labels">
     Slicing with labels
    </a>
   </li>
  </ul>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#selection-by-position">
   Selection by position
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#selection-by-callable">
   Selection by callable
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#boolean-indexing">
   Boolean indexing
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#the-query-method">
   The
   <code class="xref py py-meth docutils literal notranslate">
    <span class="pre">
     query()
    </span>
   </code>
   Method
  </a>
  <ul class="nav section-nav flex-column">
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#multiindex-query-syntax">
     <code class="xref py py-class docutils literal notranslate">
      <span class="pre">
       MultiIndex
      </span>
     </code>
     <code class="xref py py-meth docutils literal notranslate">
      <span class="pre">
       query()
      </span>
     </code>
     Syntax
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#query-use-cases">
     <code class="xref py py-meth docutils literal notranslate">
      <span class="pre">
       query()
      </span>
     </code>
     Use Cases
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#query-python-versus-pandas-syntax-comparison">
     <code class="xref py py-meth docutils literal notranslate">
      <span class="pre">
       query()
      </span>
     </code>
     Python versus pandas Syntax Comparison
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#the-in-and-not-in-operators">
     The
     <code class="docutils literal notranslate">
      <span class="pre">
       in
      </span>
     </code>
     and
     <code class="docutils literal notranslate">
      <span class="pre">
       not
      </span>
      <span class="pre">
       in
      </span>
     </code>
     operators
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#special-use-of-the-operator-with-list-objects">
     Special use of the
     <code class="docutils literal notranslate">
      <span class="pre">
       ==
      </span>
     </code>
     operator with
     <code class="docutils literal notranslate">
      <span class="pre">
       list
      </span>
     </code>
     objects
    </a>
   </li>
  </ul>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#returning-a-view-versus-a-copy">
   Returning a view versus a copy
  </a>
  <ul class="nav section-nav flex-column">
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#why-does-assignment-fail-when-using-chained-indexing">
     Why does assignment fail when using chained indexing?
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#evaluation-order-matters">
     Evaluation order matters
    </a>
   </li>
  </ul>
 </li>
</ul>

</nav>
              </div>
              
              <div class="toc-item">
                

<div class="tocsection editthispage">
    <a href="https://github.com/pandas-dev/pydata-sphinx-theme/edit/master/docs/demo/example_pandas.rst">
        <i class="fas fa-pencil-alt"></i> Edit this page
    </a>
</div>

              </div>
              
            
          </div>
          

          
          
            
          
          <main class="col-12 col-md-9 col-xl-7 py-md-5 pl-md-5 pr-md-4 bd-content" role="main">
              
              <div>
                
  <section id="pandas-example-indexing-and-selecting-data">
<span id="indexing"></span><h1>Pandas example - Indexing and selecting data<a class="headerlink" href="#pandas-example-indexing-and-selecting-data" title="永久链接至标题">#</a></h1>
<div class="admonition note">
<p class="admonition-title">备注</p>
<p>This is an example page with excerpts from the pandas docs, for some “real world” content.
But including it here apart from the rest of the pandas docs will mean that some of the links won’t work, and not all code
examples are shown with their complete outputs.</p>
</div>
<p>The axis labeling information in pandas objects serves many purposes:</p>
<ul class="simple">
<li><p>Identifies data (i.e. provides <em>metadata</em>) using known indicators,
important for analysis, visualization, and interactive console display.</p></li>
<li><p>Enables automatic and explicit data alignment.</p></li>
<li><p>Allows intuitive getting and setting of subsets of the data set.</p></li>
</ul>
<p>In this section, we will focus on the final point: namely, how to slice, dice,
and generally get and set subsets of pandas objects. The primary focus will be
on Series and DataFrame as they have received more development attention in
this area.</p>
<div class="admonition note">
<p class="admonition-title">备注</p>
<p>The Python and NumPy indexing operators <code class="docutils literal notranslate"><span class="pre">[]</span></code> and attribute operator <code class="docutils literal notranslate"><span class="pre">.</span></code>
provide quick and easy access to pandas data structures across a wide range
of use cases. This makes interactive work intuitive, as there’s little new
to learn if you already know how to deal with Python dictionaries and NumPy
arrays. However, since the type of the data to be accessed isn’t known in
advance, directly using standard operators has some optimization limits. For
production code, we recommended that you take advantage of the optimized
pandas data access methods exposed in this chapter.</p>
</div>
<div class="admonition warning">
<p class="admonition-title">警告</p>
<p>Whether a copy or a reference is returned for a setting operation, may
depend on the context. This is sometimes called <code class="docutils literal notranslate"><span class="pre">chained</span> <span class="pre">assignment</span></code> and
should be avoided. See <a class="reference internal" href="#indexing-view-versus-copy"><span class="std std-ref">Returning a View versus Copy</span></a>.</p>
</div>
<section id="different-choices-for-indexing">
<span id="indexing-choice"></span><h2>Different choices for indexing<a class="headerlink" href="#different-choices-for-indexing" title="永久链接至标题">#</a></h2>
<p>Object selection has had a number of user-requested additions in order to
support more explicit location based indexing. Pandas now supports three types
of multi-axis indexing.</p>
<ul>
<li><p><code class="docutils literal notranslate"><span class="pre">.loc</span></code> is primarily label based, but may also be used with a boolean array. <code class="docutils literal notranslate"><span class="pre">.loc</span></code> will raise <code class="docutils literal notranslate"><span class="pre">KeyError</span></code> when the items are not found. Allowed inputs are:</p>
<blockquote>
<div><ul class="simple">
<li><p>A single label, e.g. <code class="docutils literal notranslate"><span class="pre">5</span></code> or <code class="docutils literal notranslate"><span class="pre">'a'</span></code> (Note that <code class="docutils literal notranslate"><span class="pre">5</span></code> is interpreted as a
<em>label</em> of the index. This use is <strong>not</strong> an integer position along the
index.).</p></li>
<li><p>A list or array of labels <code class="docutils literal notranslate"><span class="pre">['a',</span> <span class="pre">'b',</span> <span class="pre">'c']</span></code>.</p></li>
<li><p>A slice object with labels <code class="docutils literal notranslate"><span class="pre">'a':'f'</span></code> (Note that contrary to usual python
slices, <strong>both</strong> the start and the stop are included, when present in the
index!)</p></li>
<li><p>A boolean array</p></li>
<li><p>A <code class="docutils literal notranslate"><span class="pre">callable</span></code> function with one argument (the calling Series or DataFrame) and
that returns valid output for indexing (one of the above).</p></li>
</ul>
</div></blockquote>
<p>See more at <a class="reference internal" href="#indexing-label"><span class="std std-ref">Selection by Label</span></a>.</p>
</li>
<li><p><code class="docutils literal notranslate"><span class="pre">.iloc</span></code> is primarily integer position based (from <code class="docutils literal notranslate"><span class="pre">0</span></code> to
<code class="docutils literal notranslate"><span class="pre">length-1</span></code> of the axis), but may also be used with a boolean
array.  <code class="docutils literal notranslate"><span class="pre">.iloc</span></code> will raise <code class="docutils literal notranslate"><span class="pre">IndexError</span></code> if a requested
indexer is out-of-bounds, except <em>slice</em> indexers which allow
out-of-bounds indexing.  (this conforms with Python/NumPy <em>slice</em>
semantics).  Allowed inputs are:</p>
<blockquote>
<div><ul class="simple">
<li><p>An integer e.g. <code class="docutils literal notranslate"><span class="pre">5</span></code>.</p></li>
<li><p>A list or array of integers <code class="docutils literal notranslate"><span class="pre">[4,</span> <span class="pre">3,</span> <span class="pre">0]</span></code>.</p></li>
<li><p>A slice object with ints <code class="docutils literal notranslate"><span class="pre">1:7</span></code>.</p></li>
<li><p>A boolean array.</p></li>
<li><p>A <code class="docutils literal notranslate"><span class="pre">callable</span></code> function with one argument (the calling Series or DataFrame) and
that returns valid output for indexing (one of the above).</p></li>
</ul>
</div></blockquote>
</li>
<li><p><code class="docutils literal notranslate"><span class="pre">.loc</span></code>, <code class="docutils literal notranslate"><span class="pre">.iloc</span></code>, and also <code class="docutils literal notranslate"><span class="pre">[]</span></code> indexing can accept a <code class="docutils literal notranslate"><span class="pre">callable</span></code> as indexer. See more at <a class="reference internal" href="#indexing-callable"><span class="std std-ref">Selection By Callable</span></a>.</p></li>
</ul>
<p>Getting values from an object with multi-axes selection uses the following
notation (using <code class="docutils literal notranslate"><span class="pre">.loc</span></code> as an example, but the following applies to <code class="docutils literal notranslate"><span class="pre">.iloc</span></code> as
well). Any of the axes accessors may be the null slice <code class="docutils literal notranslate"><span class="pre">:</span></code>. Axes left out of
the specification are assumed to be <code class="docutils literal notranslate"><span class="pre">:</span></code>, e.g. <code class="docutils literal notranslate"><span class="pre">p.loc['a']</span></code> is equivalent to
<code class="docutils literal notranslate"><span class="pre">p.loc['a',</span> <span class="pre">:,</span> <span class="pre">:]</span></code>.</p>
<table class="colwidths-given table">
<colgroup>
<col style="width: 38%" />
<col style="width: 63%" />
</colgroup>
<thead>
<tr class="row-odd"><th class="head"><p>Object Type</p></th>
<th class="head"><p>Indexers</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>Series</p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">s.loc[indexer]</span></code></p></td>
</tr>
<tr class="row-odd"><td><p>DataFrame</p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">df.loc[row_indexer,column_indexer]</span></code></p></td>
</tr>
</tbody>
</table>
</section>
<section id="basics">
<span id="indexing-basics"></span><h2>Basics<a class="headerlink" href="#basics" title="永久链接至标题">#</a></h2>
<p>As mentioned when introducing the data structures in the last section,
the primary function of indexing with <code class="docutils literal notranslate"><span class="pre">[]</span></code> (a.k.a. <code class="docutils literal notranslate"><span class="pre">__getitem__</span></code>
for those familiar with implementing class behavior in Python) is selecting out
lower-dimensional slices. The following table shows return type values when
indexing pandas objects with <code class="docutils literal notranslate"><span class="pre">[]</span></code>:</p>
<table class="colwidths-given table">
<colgroup>
<col style="width: 25%" />
<col style="width: 25%" />
<col style="width: 50%" />
</colgroup>
<thead>
<tr class="row-odd"><th class="head"><p>Object Type</p></th>
<th class="head"><p>Selection</p></th>
<th class="head"><p>Return Value Type</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>Series</p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">series[label]</span></code></p></td>
<td><p>scalar value</p></td>
</tr>
<tr class="row-odd"><td><p>DataFrame</p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">frame[colname]</span></code></p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">Series</span></code> corresponding to colname</p></td>
</tr>
</tbody>
</table>
<p>Here we construct a simple time series data set to use for illustrating the
indexing functionality:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">dates</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">date_range</span><span class="p">(</span><span class="s1">&#39;1/1/2000&#39;</span><span class="p">,</span> <span class="n">periods</span><span class="o">=</span><span class="mi">8</span><span class="p">)</span>

<span class="gp">&gt;&gt;&gt; </span><span class="n">df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">randn</span><span class="p">(</span><span class="mi">8</span><span class="p">,</span> <span class="mi">4</span><span class="p">),</span>
<span class="gp">... </span>                  <span class="n">index</span><span class="o">=</span><span class="n">dates</span><span class="p">,</span> <span class="n">columns</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;A&#39;</span><span class="p">,</span> <span class="s1">&#39;B&#39;</span><span class="p">,</span> <span class="s1">&#39;C&#39;</span><span class="p">,</span> <span class="s1">&#39;D&#39;</span><span class="p">])</span>
<span class="gp">...</span>

<span class="gp">&gt;&gt;&gt; </span><span class="n">df</span>
<span class="go">                A         B         C         D</span>
<span class="go">2000-01-01  0.469112 -0.282863 -1.509059 -1.135632</span>
<span class="go">2000-01-02  1.212112 -0.173215  0.119209 -1.044236</span>
<span class="go">2000-01-03 -0.861849 -2.104569 -0.494929  1.071804</span>
<span class="go">2000-01-04  0.721555 -0.706771 -1.039575  0.271860</span>
<span class="go">2000-01-05 -0.424972  0.567020  0.276232 -1.087401</span>
<span class="go">2000-01-06 -0.673690  0.113648 -1.478427  0.524988</span>
<span class="go">2000-01-07  0.404705  0.577046 -1.715002 -1.039268</span>
<span class="go">2000-01-08 -0.370647 -1.157892 -1.344312  0.844885</span>
</pre></div>
</div>
<div class="admonition note">
<p class="admonition-title">备注</p>
<p>None of the indexing functionality is time series specific unless
specifically stated.</p>
</div>
<p>Thus, as per above, we have the most basic indexing using <code class="docutils literal notranslate"><span class="pre">[]</span></code>:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">s</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="s1">&#39;A&#39;</span><span class="p">]</span>

<span class="gp">&gt;&gt;&gt; </span><span class="n">s</span><span class="p">[</span><span class="n">dates</span><span class="p">[</span><span class="mi">5</span><span class="p">]]</span>
<span class="go">-0.6736897080883706</span>
</pre></div>
</div>
<p>You can pass a list of columns to <code class="docutils literal notranslate"><span class="pre">[]</span></code> to select columns in that order.
If a column is not contained in the DataFrame, an exception will be
raised. Multiple columns can also be set in this manner:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">df</span>
<span class="go">                A         B         C         D</span>
<span class="go">2000-01-01  0.469112 -0.282863 -1.509059 -1.135632</span>
<span class="go">2000-01-02  1.212112 -0.173215  0.119209 -1.044236</span>
<span class="go">2000-01-03 -0.861849 -2.104569 -0.494929  1.071804</span>
<span class="go">2000-01-04  0.721555 -0.706771 -1.039575  0.271860</span>
<span class="go">2000-01-05 -0.424972  0.567020  0.276232 -1.087401</span>
<span class="go">2000-01-06 -0.673690  0.113648 -1.478427  0.524988</span>
<span class="go">2000-01-07  0.404705  0.577046 -1.715002 -1.039268</span>
<span class="go">2000-01-08 -0.370647 -1.157892 -1.344312  0.844885</span>

<span class="gp">&gt;&gt;&gt; </span><span class="n">df</span><span class="p">[[</span><span class="s1">&#39;B&#39;</span><span class="p">,</span> <span class="s1">&#39;A&#39;</span><span class="p">]]</span> <span class="o">=</span> <span class="n">df</span><span class="p">[[</span><span class="s1">&#39;A&#39;</span><span class="p">,</span> <span class="s1">&#39;B&#39;</span><span class="p">]]</span>

<span class="gp">&gt;&gt;&gt; </span><span class="n">df</span>
<span class="go">                A         B         C         D</span>
<span class="go">2000-01-01 -0.282863  0.469112 -1.509059 -1.135632</span>
<span class="go">2000-01-02 -0.173215  1.212112  0.119209 -1.044236</span>
<span class="go">2000-01-03 -2.104569 -0.861849 -0.494929  1.071804</span>
<span class="go">2000-01-04 -0.706771  0.721555 -1.039575  0.271860</span>
<span class="go">2000-01-05  0.567020 -0.424972  0.276232 -1.087401</span>
<span class="go">2000-01-06  0.113648 -0.673690 -1.478427  0.524988</span>
<span class="go">2000-01-07  0.577046  0.404705 -1.715002 -1.039268</span>
<span class="go">2000-01-08 -1.157892 -0.370647 -1.344312  0.844885</span>
</pre></div>
</div>
<p>You may find this useful for applying a transform (in-place) to a subset of the
columns.</p>
<div class="admonition warning">
<p class="admonition-title">警告</p>
<p>pandas aligns all AXES when setting <code class="docutils literal notranslate"><span class="pre">Series</span></code> and <code class="docutils literal notranslate"><span class="pre">DataFrame</span></code> from <code class="docutils literal notranslate"><span class="pre">.loc</span></code>, and <code class="docutils literal notranslate"><span class="pre">.iloc</span></code>.</p>
<p>This will <strong>not</strong> modify <code class="docutils literal notranslate"><span class="pre">df</span></code> because the column alignment is before value assignment.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">df</span><span class="p">[[</span><span class="s1">&#39;A&#39;</span><span class="p">,</span> <span class="s1">&#39;B&#39;</span><span class="p">]]</span>
<span class="go">                A         B</span>
<span class="go">2000-01-01 -0.282863  0.469112</span>
<span class="go">2000-01-02 -0.173215  1.212112</span>
<span class="go">2000-01-03 -2.104569 -0.861849</span>
<span class="go">2000-01-04 -0.706771  0.721555</span>
<span class="go">2000-01-05  0.567020 -0.424972</span>
<span class="go">2000-01-06  0.113648 -0.673690</span>
<span class="go">2000-01-07  0.577046  0.404705</span>
<span class="go">2000-01-08 -1.157892 -0.370647</span>

<span class="gp">&gt;&gt;&gt; </span><span class="n">df</span><span class="o">.</span><span class="n">loc</span><span class="p">[:,</span> <span class="p">[</span><span class="s1">&#39;B&#39;</span><span class="p">,</span> <span class="s1">&#39;A&#39;</span><span class="p">]]</span> <span class="o">=</span> <span class="n">df</span><span class="p">[[</span><span class="s1">&#39;A&#39;</span><span class="p">,</span> <span class="s1">&#39;B&#39;</span><span class="p">]]</span>

<span class="gp">&gt;&gt;&gt; </span><span class="n">df</span><span class="p">[[</span><span class="s1">&#39;A&#39;</span><span class="p">,</span> <span class="s1">&#39;B&#39;</span><span class="p">]]</span>
<span class="go">                A         B</span>
<span class="go">2000-01-01 -0.282863  0.469112</span>
<span class="go">2000-01-02 -0.173215  1.212112</span>
<span class="go">2000-01-03 -2.104569 -0.861849</span>
<span class="go">2000-01-04 -0.706771  0.721555</span>
<span class="go">2000-01-05  0.567020 -0.424972</span>
<span class="go">2000-01-06  0.113648 -0.673690</span>
<span class="go">2000-01-07  0.577046  0.404705</span>
<span class="go">2000-01-08 -1.157892 -0.370647</span>
</pre></div>
</div>
<p>The correct way to swap column values is by using raw values:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">df</span><span class="o">.</span><span class="n">loc</span><span class="p">[:,</span> <span class="p">[</span><span class="s1">&#39;B&#39;</span><span class="p">,</span> <span class="s1">&#39;A&#39;</span><span class="p">]]</span> <span class="o">=</span> <span class="n">df</span><span class="p">[[</span><span class="s1">&#39;A&#39;</span><span class="p">,</span> <span class="s1">&#39;B&#39;</span><span class="p">]]</span><span class="o">.</span><span class="n">to_numpy</span><span class="p">()</span>

<span class="gp">&gt;&gt;&gt; </span><span class="n">df</span><span class="p">[[</span><span class="s1">&#39;A&#39;</span><span class="p">,</span> <span class="s1">&#39;B&#39;</span><span class="p">]]</span>
<span class="go">                A         B</span>
<span class="go">2000-01-01  0.469112 -0.282863</span>
<span class="go">2000-01-02  1.212112 -0.173215</span>
<span class="go">2000-01-03 -0.861849 -2.104569</span>
<span class="go">2000-01-04  0.721555 -0.706771</span>
<span class="go">2000-01-05 -0.424972  0.567020</span>
<span class="go">2000-01-06 -0.673690  0.113648</span>
<span class="go">2000-01-07  0.404705  0.577046</span>
<span class="go">2000-01-08 -0.370647 -1.157892</span>
</pre></div>
</div>
</div>
</section>
<section id="attribute-access">
<h2>Attribute access<a class="headerlink" href="#attribute-access" title="永久链接至标题">#</a></h2>
<p id="indexing-attribute-access"><span id="indexing-df-cols"></span><span id="indexing-columns-multiple"></span>You may access an index on a <code class="docutils literal notranslate"><span class="pre">Series</span></code> or  column on a <code class="docutils literal notranslate"><span class="pre">DataFrame</span></code> directly
as an attribute:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">sa</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">Series</span><span class="p">([</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">],</span> <span class="n">index</span><span class="o">=</span><span class="nb">list</span><span class="p">(</span><span class="s1">&#39;abc&#39;</span><span class="p">))</span>
<span class="n">dfa</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
</pre></div>
</div>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">sa</span><span class="o">.</span><span class="n">b</span>
<span class="n">dfa</span><span class="o">.</span><span class="n">A</span>
</pre></div>
</div>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">sa</span><span class="o">.</span><span class="n">a</span> <span class="o">=</span> <span class="mi">5</span>

<span class="gp">&gt;&gt;&gt; </span><span class="n">sa</span>
<span class="go">a    5</span>
<span class="go">b    2</span>
<span class="go">c    3</span>
<span class="go">dtype: int64</span>

<span class="gp">&gt;&gt;&gt; </span><span class="n">dfa</span><span class="o">.</span><span class="n">A</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">dfa</span><span class="o">.</span><span class="n">index</span><span class="p">)))</span>  <span class="c1"># ok if A already exists</span>

<span class="gp">&gt;&gt;&gt; </span><span class="n">dfa</span>
<span class="go">            A         B         C         D</span>
<span class="go">2000-01-01  0 -0.282863 -1.509059 -1.135632</span>
<span class="go">2000-01-02  1 -0.173215  0.119209 -1.044236</span>
<span class="go">2000-01-03  2 -2.104569 -0.494929  1.071804</span>
<span class="go">2000-01-04  3 -0.706771 -1.039575  0.271860</span>
<span class="go">2000-01-05  4  0.567020  0.276232 -1.087401</span>
<span class="go">2000-01-06  5  0.113648 -1.478427  0.524988</span>
<span class="go">2000-01-07  6  0.577046 -1.715002 -1.039268</span>
<span class="go">2000-01-08  7 -1.157892 -1.344312  0.844885</span>

<span class="gp">&gt;&gt;&gt; </span><span class="n">dfa</span><span class="p">[</span><span class="s1">&#39;A&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">dfa</span><span class="o">.</span><span class="n">index</span><span class="p">)))</span>  <span class="c1"># use this form to create a new column</span>

<span class="gp">&gt;&gt;&gt; </span><span class="n">dfa</span>
<span class="go">            A         B         C         D</span>
<span class="go">2000-01-01  0 -0.282863 -1.509059 -1.135632</span>
<span class="go">2000-01-02  1 -0.173215  0.119209 -1.044236</span>
<span class="go">2000-01-03  2 -2.104569 -0.494929  1.071804</span>
<span class="go">2000-01-04  3 -0.706771 -1.039575  0.271860</span>
<span class="go">2000-01-05  4  0.567020  0.276232 -1.087401</span>
<span class="go">2000-01-06  5  0.113648 -1.478427  0.524988</span>
<span class="go">2000-01-07  6  0.577046 -1.715002 -1.039268</span>
<span class="go">2000-01-08  7 -1.157892 -1.344312  0.844885</span>
</pre></div>
</div>
<div class="admonition warning">
<p class="admonition-title">警告</p>
<ul class="simple">
<li><p>You can use this access only if the index element is a valid Python identifier, e.g. <code class="docutils literal notranslate"><span class="pre">s.1</span></code> is not allowed.
See <a class="reference external" href="https://docs.python.org/3/reference/lexical_analysis.html#identifiers">here for an explanation of valid identifiers</a>.</p></li>
<li><p>The attribute will not be available if it conflicts with an existing method name, e.g. <code class="docutils literal notranslate"><span class="pre">s.min</span></code> is not allowed, but <code class="docutils literal notranslate"><span class="pre">s['min']</span></code> is possible.</p></li>
<li><p>Similarly, the attribute will not be available if it conflicts with any of the following list: <code class="docutils literal notranslate"><span class="pre">index</span></code>,
<code class="docutils literal notranslate"><span class="pre">major_axis</span></code>, <code class="docutils literal notranslate"><span class="pre">minor_axis</span></code>, <code class="docutils literal notranslate"><span class="pre">items</span></code>.</p></li>
<li><p>In any of these cases, standard indexing will still work, e.g. <code class="docutils literal notranslate"><span class="pre">s['1']</span></code>, <code class="docutils literal notranslate"><span class="pre">s['min']</span></code>, and <code class="docutils literal notranslate"><span class="pre">s['index']</span></code> will
access the corresponding element or column.</p></li>
</ul>
</div>
<p>If you are using the IPython environment, you may also use tab-completion to
see these accessible attributes.</p>
<p>You can also assign a <code class="docutils literal notranslate"><span class="pre">dict</span></code> to a row of a <code class="docutils literal notranslate"><span class="pre">DataFrame</span></code>:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">x</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">({</span><span class="s1">&#39;x&#39;</span><span class="p">:</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">],</span> <span class="s1">&#39;y&#39;</span><span class="p">:</span> <span class="p">[</span><span class="mi">3</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">5</span><span class="p">]})</span>

<span class="gp">&gt;&gt;&gt; </span><span class="n">x</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;x&#39;</span><span class="p">:</span> <span class="mi">9</span><span class="p">,</span> <span class="s1">&#39;y&#39;</span><span class="p">:</span> <span class="mi">99</span><span class="p">}</span>

<span class="gp">&gt;&gt;&gt; </span><span class="n">x</span>
<span class="go">x   y</span>
<span class="go">0  1   3</span>
<span class="go">1  9  99</span>
<span class="go">2  3   5</span>
</pre></div>
</div>
<p>You can use attribute access to modify an existing element of a Series or column of a DataFrame, but be careful;
if you try to use attribute access to create a new column, it creates a new attribute rather than a
new column. In 0.21.0 and later, this will raise a <code class="docutils literal notranslate"><span class="pre">UserWarning</span></code>:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">({</span><span class="s1">&#39;one&#39;</span><span class="p">:</span> <span class="p">[</span><span class="mf">1.</span><span class="p">,</span> <span class="mf">2.</span><span class="p">,</span> <span class="mf">3.</span><span class="p">]})</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">df</span><span class="o">.</span><span class="n">two</span> <span class="o">=</span> <span class="p">[</span><span class="mi">4</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="mi">6</span><span class="p">]</span>
<span class="go">UserWarning: Pandas doesn&#39;t allow Series to be assigned into nonexistent columns - see https://pandas.pydata.org/pandas-docs/stable/indexing.html#attribute_access</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">df</span>
<span class="go">   one</span>
<span class="go">0  1.0</span>
<span class="go">1  2.0</span>
<span class="go">2  3.0</span>
</pre></div>
</div>
</section>
<section id="selection-by-label">
<span id="indexing-label"></span><h2>Selection by label<a class="headerlink" href="#selection-by-label" title="永久链接至标题">#</a></h2>
<div class="admonition warning">
<p class="admonition-title">警告</p>
<p>Whether a copy or a reference is returned for a setting operation, may depend on the context.
This is sometimes called <code class="docutils literal notranslate"><span class="pre">chained</span> <span class="pre">assignment</span></code> and should be avoided.
See <a class="reference internal" href="#indexing-view-versus-copy"><span class="std std-ref">Returning a View versus Copy</span></a>.</p>
</div>
<div class="admonition warning">
<p class="admonition-title">警告</p>
<blockquote>
<div><p><code class="docutils literal notranslate"><span class="pre">.loc</span></code> is strict when you present slicers that are not compatible (or convertible) with the index type. For example
using integers in a <code class="docutils literal notranslate"><span class="pre">DatetimeIndex</span></code>. These will raise a <code class="docutils literal notranslate"><span class="pre">TypeError</span></code>.</p>
</div></blockquote>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">dfl</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">randn</span><span class="p">(</span><span class="mi">5</span><span class="p">,</span> <span class="mi">4</span><span class="p">),</span>
                   <span class="n">columns</span><span class="o">=</span><span class="nb">list</span><span class="p">(</span><span class="s1">&#39;ABCD&#39;</span><span class="p">),</span>
                   <span class="n">index</span><span class="o">=</span><span class="n">pd</span><span class="o">.</span><span class="n">date_range</span><span class="p">(</span><span class="s1">&#39;20130101&#39;</span><span class="p">,</span> <span class="n">periods</span><span class="o">=</span><span class="mi">5</span><span class="p">))</span>
<span class="n">dfl</span>
</pre></div>
</div>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">dfl</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="mi">2</span><span class="p">:</span><span class="mi">3</span><span class="p">]</span>
<span class="go">TypeError: cannot do slice indexing on &lt;class &#39;pandas.tseries.index.DatetimeIndex&#39;&gt; with these indexers [2] of &lt;type &#39;int&#39;&gt;</span>
</pre></div>
</div>
<p>String likes in slicing <em>can</em> be convertible to the type of the index and lead to natural slicing.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">dfl</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="s1">&#39;20130102&#39;</span><span class="p">:</span><span class="s1">&#39;20130104&#39;</span><span class="p">]</span>
</pre></div>
</div>
</div>
<p>pandas provides a suite of methods in order to have <strong>purely label based indexing</strong>. This is a strict inclusion based protocol.
Every label asked for must be in the index, or a <code class="docutils literal notranslate"><span class="pre">KeyError</span></code> will be raised.
When slicing, both the start bound <strong>AND</strong> the stop bound are <em>included</em>, if present in the index.
Integers are valid labels, but they refer to the label <strong>and not the position</strong>.</p>
<p>The <code class="docutils literal notranslate"><span class="pre">.loc</span></code> attribute is the primary access method. The following are valid inputs:</p>
<ul class="simple">
<li><p>A single label, e.g. <code class="docutils literal notranslate"><span class="pre">5</span></code> or <code class="docutils literal notranslate"><span class="pre">'a'</span></code> (Note that <code class="docutils literal notranslate"><span class="pre">5</span></code> is interpreted as a <em>label</em> of the index. This use is <strong>not</strong> an integer position along the index.).</p></li>
<li><p>A list or array of labels <code class="docutils literal notranslate"><span class="pre">['a',</span> <span class="pre">'b',</span> <span class="pre">'c']</span></code>.</p></li>
<li><p>A slice object with labels <code class="docutils literal notranslate"><span class="pre">'a':'f'</span></code> (Note that contrary to usual python
slices, <strong>both</strong> the start and the stop are included, when present in the
index! See <a class="reference internal" href="#indexing-slicing-with-labels"><span class="std std-ref">Slicing with labels</span></a>.</p></li>
<li><p>A boolean array.</p></li>
<li><p>A <code class="docutils literal notranslate"><span class="pre">callable</span></code>, see <a class="reference internal" href="#indexing-callable"><span class="std std-ref">Selection By Callable</span></a>.</p></li>
</ul>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">s1</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">Series</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">randn</span><span class="p">(</span><span class="mi">6</span><span class="p">),</span> <span class="n">index</span><span class="o">=</span><span class="nb">list</span><span class="p">(</span><span class="s1">&#39;abcdef&#39;</span><span class="p">))</span>

<span class="gp">&gt;&gt;&gt; </span><span class="n">s1</span>
<span class="go">a    1.431256</span>
<span class="go">b    1.340309</span>
<span class="go">c   -1.170299</span>
<span class="go">d   -0.226169</span>
<span class="go">e    0.410835</span>
<span class="go">f    0.813850</span>
<span class="go">dtype: float64</span>

<span class="gp">&gt;&gt;&gt; </span><span class="n">s1</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="s1">&#39;c&#39;</span><span class="p">:]</span>
<span class="go">c   -1.170299</span>
<span class="go">d   -0.226169</span>
<span class="go">e    0.410835</span>
<span class="go">f    0.813850</span>
<span class="go">dtype: float64</span>

<span class="gp">&gt;&gt;&gt; </span><span class="n">s1</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="s1">&#39;b&#39;</span><span class="p">]</span>
<span class="go">1.3403088497993827</span>
</pre></div>
</div>
<p>Note that setting works as well:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">s1</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="s1">&#39;c&#39;</span><span class="p">:]</span> <span class="o">=</span> <span class="mi">0</span>

<span class="gp">&gt;&gt;&gt; </span><span class="n">s1</span>
<span class="go">a    1.431256</span>
<span class="go">b    1.340309</span>
<span class="go">c    0.000000</span>
<span class="go">d    0.000000</span>
<span class="go">e    0.000000</span>
<span class="go">f    0.000000</span>
<span class="go">dtype: float64</span>
</pre></div>
</div>
<p>With a DataFrame:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">df1</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">randn</span><span class="p">(</span><span class="mi">6</span><span class="p">,</span> <span class="mi">4</span><span class="p">),</span>
<span class="go">....                    index=list(&#39;abcdef&#39;),</span>
<span class="go">....                    columns=list(&#39;ABCD&#39;))</span>
<span class="go">....</span>

<span class="gp">&gt;&gt;&gt; </span><span class="n">df1</span>
<span class="go">        A         B         C         D</span>
<span class="go">a  0.132003 -0.827317 -0.076467 -1.187678</span>
<span class="go">b  1.130127 -1.436737 -1.413681  1.607920</span>
<span class="go">c  1.024180  0.569605  0.875906 -2.211372</span>
<span class="go">d  0.974466 -2.006747 -0.410001 -0.078638</span>
<span class="go">e  0.545952 -1.219217 -1.226825  0.769804</span>
<span class="go">f -1.281247 -0.727707 -0.121306 -0.097883</span>

<span class="gp">&gt;&gt;&gt; </span><span class="n">df1</span><span class="o">.</span><span class="n">loc</span><span class="p">[[</span><span class="s1">&#39;a&#39;</span><span class="p">,</span> <span class="s1">&#39;b&#39;</span><span class="p">,</span> <span class="s1">&#39;d&#39;</span><span class="p">],</span> <span class="p">:]</span>
<span class="go">        A         B         C         D</span>
<span class="go">a  0.132003 -0.827317 -0.076467 -1.187678</span>
<span class="go">b  1.130127 -1.436737 -1.413681  1.607920</span>
</pre></div>
</div>
<section id="slicing-with-labels">
<span id="indexing-slicing-with-labels"></span><h3>Slicing with labels<a class="headerlink" href="#slicing-with-labels" title="永久链接至标题">#</a></h3>
<p>When using <code class="docutils literal notranslate"><span class="pre">.loc</span></code> with slices, if both the start and the stop labels are
present in the index, then elements <em>located</em> between the two (including them)
are returned:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">s</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">Series</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="s1">&#39;abcde&#39;</span><span class="p">),</span> <span class="n">index</span><span class="o">=</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="mi">4</span><span class="p">])</span>

<span class="gp">&gt;&gt;&gt; </span><span class="n">s</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="mi">3</span><span class="p">:</span><span class="mi">5</span><span class="p">]</span>
<span class="go">3    b</span>
<span class="go">2    c</span>
<span class="go">5    d</span>
<span class="go">dtype: object</span>
</pre></div>
</div>
<p>If at least one of the two is absent, but the index is sorted, and can be
compared against start and stop labels, then slicing will still work as
expected, by selecting labels which <em>rank</em> between the two:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">s</span><span class="o">.</span><span class="n">sort_index</span><span class="p">()</span>
<span class="go">0    a</span>
<span class="go">2    c</span>
<span class="go">3    b</span>
<span class="go">4    e</span>
<span class="go">5    d</span>
<span class="go">dtype: object</span>

<span class="gp">&gt;&gt;&gt; </span><span class="n">s</span><span class="o">.</span><span class="n">sort_index</span><span class="p">()</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="mi">1</span><span class="p">:</span><span class="mi">6</span><span class="p">]</span>
<span class="go">2    c</span>
<span class="go">3    b</span>
<span class="go">4    e</span>
<span class="go">5    d</span>
<span class="go">dtype: object</span>
</pre></div>
</div>
<p>However, if at least one of the two is absent <em>and</em> the index is not sorted, an
error will be raised (since doing otherwise would be computationally expensive,
as well as potentially ambiguous for mixed type indexes). For instance, in the
above example, <code class="docutils literal notranslate"><span class="pre">s.loc[1:6]</span></code> would raise <code class="docutils literal notranslate"><span class="pre">KeyError</span></code>.</p>
</section>
</section>
<section id="selection-by-position">
<span id="indexing-integer"></span><h2>Selection by position<a class="headerlink" href="#selection-by-position" title="永久链接至标题">#</a></h2>
<div class="admonition warning">
<p class="admonition-title">警告</p>
<p>Whether a copy or a reference is returned for a setting operation, may depend on the context.
This is sometimes called <code class="docutils literal notranslate"><span class="pre">chained</span> <span class="pre">assignment</span></code> and should be avoided.
See <a class="reference internal" href="#indexing-view-versus-copy"><span class="std std-ref">Returning a View versus Copy</span></a>.</p>
</div>
<p>Pandas provides a suite of methods in order to get <strong>purely integer based indexing</strong>. The semantics follow closely Python and NumPy slicing. These are <code class="docutils literal notranslate"><span class="pre">0-based</span></code> indexing. When slicing, the start bound is <em>included</em>, while the upper bound is <em>excluded</em>. Trying to use a non-integer, even a <strong>valid</strong> label will raise an <code class="docutils literal notranslate"><span class="pre">IndexError</span></code>.</p>
<p>The <code class="docutils literal notranslate"><span class="pre">.iloc</span></code> attribute is the primary access method. The following are valid inputs:</p>
<ul class="simple">
<li><p>An integer e.g. <code class="docutils literal notranslate"><span class="pre">5</span></code>.</p></li>
<li><p>A list or array of integers <code class="docutils literal notranslate"><span class="pre">[4,</span> <span class="pre">3,</span> <span class="pre">0]</span></code>.</p></li>
<li><p>A slice object with ints <code class="docutils literal notranslate"><span class="pre">1:7</span></code>.</p></li>
<li><p>A boolean array.</p></li>
<li><p>A <code class="docutils literal notranslate"><span class="pre">callable</span></code>, see <a class="reference internal" href="#indexing-callable"><span class="std std-ref">Selection By Callable</span></a>.</p></li>
</ul>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">s1</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">Series</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">randn</span><span class="p">(</span><span class="mi">5</span><span class="p">),</span> <span class="n">index</span><span class="o">=</span><span class="nb">list</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">10</span><span class="p">,</span> <span class="mi">2</span><span class="p">)))</span>

<span class="gp">&gt;&gt;&gt; </span><span class="n">s1</span>
<span class="go">0    0.695775</span>
<span class="go">2    0.341734</span>
<span class="go">4    0.959726</span>
<span class="go">6   -1.110336</span>
<span class="go">8   -0.619976</span>
<span class="go">dtype: float64</span>

<span class="gp">&gt;&gt;&gt; </span><span class="n">s1</span><span class="o">.</span><span class="n">iloc</span><span class="p">[:</span><span class="mi">3</span><span class="p">]</span>
<span class="go">0    0.695775</span>
<span class="go">2    0.341734</span>
<span class="go">4    0.959726</span>
<span class="go">dtype: float64</span>

<span class="gp">&gt;&gt;&gt; </span><span class="n">s1</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span>
<span class="go">-1.110336102891167</span>
</pre></div>
</div>
<p>Note that setting works as well:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">s1</span><span class="o">.</span><span class="n">iloc</span><span class="p">[:</span><span class="mi">3</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span>
<span class="n">s1</span>
</pre></div>
</div>
<p>With a DataFrame:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">df1</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">randn</span><span class="p">(</span><span class="mi">6</span><span class="p">,</span> <span class="mi">4</span><span class="p">),</span>
                   <span class="n">index</span><span class="o">=</span><span class="nb">list</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">12</span><span class="p">,</span> <span class="mi">2</span><span class="p">)),</span>
                   <span class="n">columns</span><span class="o">=</span><span class="nb">list</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">8</span><span class="p">,</span> <span class="mi">2</span><span class="p">)))</span>
<span class="n">df1</span>
</pre></div>
</div>
<p>Select via integer slicing:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">df1</span><span class="o">.</span><span class="n">iloc</span><span class="p">[:</span><span class="mi">3</span><span class="p">]</span>
<span class="n">df1</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="mi">1</span><span class="p">:</span><span class="mi">5</span><span class="p">,</span> <span class="mi">2</span><span class="p">:</span><span class="mi">4</span><span class="p">]</span>
</pre></div>
</div>
<p>Select via integer list:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">df1</span><span class="o">.</span><span class="n">iloc</span><span class="p">[[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">5</span><span class="p">],</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">3</span><span class="p">]]</span>
</pre></div>
</div>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">df1</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="mi">1</span><span class="p">:</span><span class="mi">3</span><span class="p">,</span> <span class="p">:]</span>
</pre></div>
</div>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">df1</span><span class="o">.</span><span class="n">iloc</span><span class="p">[:,</span> <span class="mi">1</span><span class="p">:</span><span class="mi">3</span><span class="p">]</span>
</pre></div>
</div>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1"># this is also equivalent to ``df1.iat[1,1]``</span>
<span class="n">df1</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">]</span>
</pre></div>
</div>
<p>For getting a cross section using an integer position (equiv to <code class="docutils literal notranslate"><span class="pre">df.xs(1)</span></code>):</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">df1</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
</pre></div>
</div>
<p>Out of range slice indexes are handled gracefully just as in Python/Numpy.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1"># these are allowed in python/numpy.</span>
<span class="n">x</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="s1">&#39;abcdef&#39;</span><span class="p">)</span>
<span class="n">x</span>
<span class="n">x</span><span class="p">[</span><span class="mi">4</span><span class="p">:</span><span class="mi">10</span><span class="p">]</span>
<span class="n">x</span><span class="p">[</span><span class="mi">8</span><span class="p">:</span><span class="mi">10</span><span class="p">]</span>
<span class="n">s</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">Series</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
<span class="n">s</span>
<span class="n">s</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="mi">4</span><span class="p">:</span><span class="mi">10</span><span class="p">]</span>
<span class="n">s</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="mi">8</span><span class="p">:</span><span class="mi">10</span><span class="p">]</span>
</pre></div>
</div>
<p>Note that using slices that go out of bounds can result in
an empty axis (e.g. an empty DataFrame being returned).</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">dfl</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">randn</span><span class="p">(</span><span class="mi">5</span><span class="p">,</span> <span class="mi">2</span><span class="p">),</span> <span class="n">columns</span><span class="o">=</span><span class="nb">list</span><span class="p">(</span><span class="s1">&#39;AB&#39;</span><span class="p">))</span>
<span class="n">dfl</span>
<span class="n">dfl</span><span class="o">.</span><span class="n">iloc</span><span class="p">[:,</span> <span class="mi">2</span><span class="p">:</span><span class="mi">3</span><span class="p">]</span>
<span class="n">dfl</span><span class="o">.</span><span class="n">iloc</span><span class="p">[:,</span> <span class="mi">1</span><span class="p">:</span><span class="mi">3</span><span class="p">]</span>
<span class="n">dfl</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="mi">4</span><span class="p">:</span><span class="mi">6</span><span class="p">]</span>
</pre></div>
</div>
<p>A single indexer that is out of bounds will raise an <code class="docutils literal notranslate"><span class="pre">IndexError</span></code>.
A list of indexers where any element is out of bounds will raise an
<code class="docutils literal notranslate"><span class="pre">IndexError</span></code>.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">dfl</span><span class="o">.</span><span class="n">iloc</span><span class="p">[[</span><span class="mi">4</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="mi">6</span><span class="p">]]</span>
<span class="go">IndexError: positional indexers are out-of-bounds</span>

<span class="gp">&gt;&gt;&gt; </span><span class="n">dfl</span><span class="o">.</span><span class="n">iloc</span><span class="p">[:,</span> <span class="mi">4</span><span class="p">]</span>
<span class="go">IndexError: single positional indexer is out-of-bounds</span>
</pre></div>
</div>
</section>
<section id="selection-by-callable">
<span id="indexing-callable"></span><h2>Selection by callable<a class="headerlink" href="#selection-by-callable" title="永久链接至标题">#</a></h2>
<p><code class="docutils literal notranslate"><span class="pre">.loc</span></code>, <code class="docutils literal notranslate"><span class="pre">.iloc</span></code>, and also <code class="docutils literal notranslate"><span class="pre">[]</span></code> indexing can accept a <code class="docutils literal notranslate"><span class="pre">callable</span></code> as indexer.
The <code class="docutils literal notranslate"><span class="pre">callable</span></code> must be a function with one argument (the calling Series or DataFrame) that returns valid output for indexing.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">df1</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">randn</span><span class="p">(</span><span class="mi">6</span><span class="p">,</span> <span class="mi">4</span><span class="p">),</span>
<span class="go">....                    index=list(&#39;abcdef&#39;),</span>
<span class="go">....                    columns=list(&#39;ABCD&#39;))</span>
<span class="go">....</span>

<span class="gp">&gt;&gt;&gt; </span><span class="n">df1</span>
<span class="go">        A         B         C         D</span>
<span class="go">a -0.023688  2.410179  1.450520  0.206053</span>
<span class="go">b -0.251905 -2.213588  1.063327  1.266143</span>
<span class="go">c  0.299368 -0.863838  0.408204 -1.048089</span>
<span class="go">d -0.025747 -0.988387  0.094055  1.262731</span>
<span class="go">e  1.289997  0.082423 -0.055758  0.536580</span>
<span class="go">f -0.489682  0.369374 -0.034571 -2.484478</span>

<span class="gp">&gt;&gt;&gt; </span><span class="n">df1</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="k">lambda</span> <span class="n">df</span><span class="p">:</span> <span class="n">df</span><span class="p">[</span><span class="s1">&#39;A&#39;</span><span class="p">]</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">,</span> <span class="p">:]</span>
<span class="go">        A         B         C         D</span>
<span class="go">c  0.299368 -0.863838  0.408204 -1.048089</span>
<span class="go">e  1.289997  0.082423 -0.055758  0.536580</span>

<span class="gp">&gt;&gt;&gt; </span><span class="n">df1</span><span class="o">.</span><span class="n">loc</span><span class="p">[:,</span> <span class="k">lambda</span> <span class="n">df</span><span class="p">:</span> <span class="p">[</span><span class="s1">&#39;A&#39;</span><span class="p">,</span> <span class="s1">&#39;B&#39;</span><span class="p">]]</span>
<span class="go">        A         B</span>
<span class="go">a -0.023688  2.410179</span>
<span class="go">b -0.251905 -2.213588</span>
<span class="go">c  0.299368 -0.863838</span>
<span class="go">d -0.025747 -0.988387</span>
<span class="go">e  1.289997  0.082423</span>
<span class="go">f -0.489682  0.369374</span>

<span class="gp">&gt;&gt;&gt; </span><span class="n">df1</span><span class="o">.</span><span class="n">iloc</span><span class="p">[:,</span> <span class="k">lambda</span> <span class="n">df</span><span class="p">:</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">]]</span>
<span class="go">        A         B</span>
<span class="go">a -0.023688  2.410179</span>
<span class="go">b -0.251905 -2.213588</span>
<span class="go">c  0.299368 -0.863838</span>
<span class="go">d -0.025747 -0.988387</span>
<span class="go">e  1.289997  0.082423</span>
<span class="go">f -0.489682  0.369374</span>

<span class="gp">&gt;&gt;&gt; </span><span class="n">df1</span><span class="p">[</span><span class="k">lambda</span> <span class="n">df</span><span class="p">:</span> <span class="n">df</span><span class="o">.</span><span class="n">columns</span><span class="p">[</span><span class="mi">0</span><span class="p">]]</span>
<span class="go">a   -0.023688</span>
<span class="go">b   -0.251905</span>
<span class="go">c    0.299368</span>
<span class="go">d   -0.025747</span>
<span class="go">e    1.289997</span>
<span class="go">f   -0.489682</span>
<span class="go">Name: A, dtype: float64</span>
</pre></div>
</div>
<p>You can use callable indexing in <code class="docutils literal notranslate"><span class="pre">Series</span></code>.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">df1</span><span class="p">[</span><span class="s1">&#39;A&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="k">lambda</span> <span class="n">s</span><span class="p">:</span> <span class="n">s</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">]</span>
</pre></div>
</div>
<p>Using these methods / indexers, you can chain data selection operations
without using a temporary variable.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">bb</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="s1">&#39;data/baseball.csv&#39;</span><span class="p">,</span> <span class="n">index_col</span><span class="o">=</span><span class="s1">&#39;id&#39;</span><span class="p">)</span>
<span class="p">(</span><span class="n">bb</span><span class="o">.</span><span class="n">groupby</span><span class="p">([</span><span class="s1">&#39;year&#39;</span><span class="p">,</span> <span class="s1">&#39;team&#39;</span><span class="p">])</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span>
   <span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="k">lambda</span> <span class="n">df</span><span class="p">:</span> <span class="n">df</span><span class="p">[</span><span class="s1">&#39;r&#39;</span><span class="p">]</span> <span class="o">&gt;</span> <span class="mi">100</span><span class="p">])</span>
</pre></div>
</div>
</section>
<section id="boolean-indexing">
<h2>Boolean indexing<a class="headerlink" href="#boolean-indexing" title="永久链接至标题">#</a></h2>
<p id="indexing-boolean">Another common operation is the use of boolean vectors to filter the data.
The operators are: <code class="docutils literal notranslate"><span class="pre">|</span></code> for <code class="docutils literal notranslate"><span class="pre">or</span></code>, <code class="docutils literal notranslate"><span class="pre">&amp;</span></code> for <code class="docutils literal notranslate"><span class="pre">and</span></code>, and <code class="docutils literal notranslate"><span class="pre">~</span></code> for <code class="docutils literal notranslate"><span class="pre">not</span></code>.
These <strong>must</strong> be grouped by using parentheses, since by default Python will
evaluate an expression such as <code class="docutils literal notranslate"><span class="pre">df['A']</span> <span class="pre">&gt;</span> <span class="pre">2</span> <span class="pre">&amp;</span> <span class="pre">df['B']</span> <span class="pre">&lt;</span> <span class="pre">3</span></code> as
<code class="docutils literal notranslate"><span class="pre">df['A']</span> <span class="pre">&gt;</span> <span class="pre">(2</span> <span class="pre">&amp;</span> <span class="pre">df['B'])</span> <span class="pre">&lt;</span> <span class="pre">3</span></code>, while the desired evaluation order is
<code class="docutils literal notranslate"><span class="pre">(df['A</span> <span class="pre">&gt;</span> <span class="pre">2)</span> <span class="pre">&amp;</span> <span class="pre">(df['B']</span> <span class="pre">&lt;</span> <span class="pre">3)</span></code>.</p>
<p>Using a boolean vector to index a Series works exactly as in a NumPy ndarray:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">s</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">Series</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="o">-</span><span class="mi">3</span><span class="p">,</span> <span class="mi">4</span><span class="p">))</span>

<span class="gp">&gt;&gt;&gt; </span><span class="n">s</span>
<span class="go">0   -3</span>
<span class="go">1   -2</span>
<span class="go">2   -1</span>
<span class="go">3    0</span>
<span class="go">4    1</span>
<span class="go">5    2</span>
<span class="go">6    3</span>
<span class="go">dtype: int64</span>

<span class="gp">&gt;&gt;&gt; </span><span class="n">s</span><span class="p">[</span><span class="n">s</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">]</span>
<span class="go">4    1</span>
<span class="go">5    2</span>
<span class="go">6    3</span>
<span class="go">dtype: int64</span>

<span class="gp">&gt;&gt;&gt; </span><span class="n">s</span><span class="p">[(</span><span class="n">s</span> <span class="o">&lt;</span> <span class="o">-</span><span class="mi">1</span><span class="p">)</span> <span class="o">|</span> <span class="p">(</span><span class="n">s</span> <span class="o">&gt;</span> <span class="mf">0.5</span><span class="p">)]</span>
<span class="go">0   -3</span>
<span class="go">1   -2</span>
<span class="go">4    1</span>
<span class="go">5    2</span>
<span class="go">6    3</span>
<span class="go">dtype: int64</span>

<span class="gp">&gt;&gt;&gt; </span><span class="n">s</span><span class="p">[</span><span class="o">~</span><span class="p">(</span><span class="n">s</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">)]</span>
<span class="go">3    0</span>
<span class="go">4    1</span>
<span class="go">5    2</span>
<span class="go">6    3</span>
<span class="go">dtype: int64</span>
</pre></div>
</div>
<p>You may select rows from a DataFrame using a boolean vector the same length as
the DataFrame’s index (for example, something derived from one of the columns
of the DataFrame):</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">df</span><span class="p">[</span><span class="n">df</span><span class="p">[</span><span class="s1">&#39;A&#39;</span><span class="p">]</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">]</span>
</pre></div>
</div>
<p>List comprehensions and the <code class="docutils literal notranslate"><span class="pre">map</span></code> method of Series can also be used to produce
more complex criteria:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">df2</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">({</span><span class="s1">&#39;a&#39;</span><span class="p">:</span> <span class="p">[</span><span class="s1">&#39;one&#39;</span><span class="p">,</span> <span class="s1">&#39;one&#39;</span><span class="p">,</span> <span class="s1">&#39;two&#39;</span><span class="p">,</span> <span class="s1">&#39;three&#39;</span><span class="p">,</span> <span class="s1">&#39;two&#39;</span><span class="p">,</span> <span class="s1">&#39;one&#39;</span><span class="p">,</span> <span class="s1">&#39;six&#39;</span><span class="p">],</span>
                    <span class="s1">&#39;b&#39;</span><span class="p">:</span> <span class="p">[</span><span class="s1">&#39;x&#39;</span><span class="p">,</span> <span class="s1">&#39;y&#39;</span><span class="p">,</span> <span class="s1">&#39;y&#39;</span><span class="p">,</span> <span class="s1">&#39;x&#39;</span><span class="p">,</span> <span class="s1">&#39;y&#39;</span><span class="p">,</span> <span class="s1">&#39;x&#39;</span><span class="p">,</span> <span class="s1">&#39;x&#39;</span><span class="p">],</span>
                    <span class="s1">&#39;c&#39;</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">randn</span><span class="p">(</span><span class="mi">7</span><span class="p">)})</span>

<span class="c1"># only want &#39;two&#39; or &#39;three&#39;</span>
<span class="n">criterion</span> <span class="o">=</span> <span class="n">df2</span><span class="p">[</span><span class="s1">&#39;a&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">map</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">x</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s1">&#39;t&#39;</span><span class="p">))</span>

<span class="n">df2</span><span class="p">[</span><span class="n">criterion</span><span class="p">]</span>

<span class="c1"># equivalent but slower</span>
<span class="n">df2</span><span class="p">[[</span><span class="n">x</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s1">&#39;t&#39;</span><span class="p">)</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">df2</span><span class="p">[</span><span class="s1">&#39;a&#39;</span><span class="p">]]]</span>

<span class="c1"># Multiple criteria</span>
<span class="n">df2</span><span class="p">[</span><span class="n">criterion</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">df2</span><span class="p">[</span><span class="s1">&#39;b&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;x&#39;</span><span class="p">)]</span>
</pre></div>
</div>
<p>With the choice methods <a class="reference internal" href="#indexing-label"><span class="std std-ref">Selection by Label</span></a>, <a class="reference internal" href="#indexing-integer"><span class="std std-ref">Selection by Position</span></a> you may select along more than one axis using boolean vectors combined with other indexing expressions.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">df2</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">criterion</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">df2</span><span class="p">[</span><span class="s1">&#39;b&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;x&#39;</span><span class="p">),</span> <span class="s1">&#39;b&#39;</span><span class="p">:</span><span class="s1">&#39;c&#39;</span><span class="p">]</span>
</pre></div>
</div>
</section>
<section id="the-query-method">
<span id="indexing-query"></span><h2>The <code class="xref py py-meth docutils literal notranslate"><span class="pre">query()</span></code> Method<a class="headerlink" href="#the-query-method" title="永久链接至标题">#</a></h2>
<p><code class="xref py py-class docutils literal notranslate"><span class="pre">DataFrame</span></code> objects have a <code class="xref py py-meth docutils literal notranslate"><span class="pre">query()</span></code>
method that allows selection using an expression.</p>
<p>You can get the value of the frame where column <code class="docutils literal notranslate"><span class="pre">b</span></code> has values
between the values of columns <code class="docutils literal notranslate"><span class="pre">a</span></code> and <code class="docutils literal notranslate"><span class="pre">c</span></code>. For example:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">n</span> <span class="o">=</span> <span class="mi">10</span>
<span class="n">df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">rand</span><span class="p">(</span><span class="n">n</span><span class="p">,</span> <span class="mi">3</span><span class="p">),</span> <span class="n">columns</span><span class="o">=</span><span class="nb">list</span><span class="p">(</span><span class="s1">&#39;abc&#39;</span><span class="p">))</span>
<span class="n">df</span>

<span class="c1"># pure python</span>
<span class="n">df</span><span class="p">[(</span><span class="n">df</span><span class="p">[</span><span class="s1">&#39;a&#39;</span><span class="p">]</span> <span class="o">&lt;</span> <span class="n">df</span><span class="p">[</span><span class="s1">&#39;b&#39;</span><span class="p">])</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">df</span><span class="p">[</span><span class="s1">&#39;b&#39;</span><span class="p">]</span> <span class="o">&lt;</span> <span class="n">df</span><span class="p">[</span><span class="s1">&#39;c&#39;</span><span class="p">])]</span>

<span class="c1"># query</span>
<span class="n">df</span><span class="o">.</span><span class="n">query</span><span class="p">(</span><span class="s1">&#39;(a &lt; b) &amp; (b &lt; c)&#39;</span><span class="p">)</span>
</pre></div>
</div>
<p>Do the same thing but fall back on a named index if there is no column
with the name <code class="docutils literal notranslate"><span class="pre">a</span></code>.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">randint</span><span class="p">(</span><span class="n">n</span> <span class="o">/</span> <span class="mi">2</span><span class="p">,</span> <span class="n">size</span><span class="o">=</span><span class="p">(</span><span class="n">n</span><span class="p">,</span> <span class="mi">2</span><span class="p">)),</span> <span class="n">columns</span><span class="o">=</span><span class="nb">list</span><span class="p">(</span><span class="s1">&#39;bc&#39;</span><span class="p">))</span>
<span class="n">df</span><span class="o">.</span><span class="n">index</span><span class="o">.</span><span class="n">name</span> <span class="o">=</span> <span class="s1">&#39;a&#39;</span>
<span class="n">df</span>
<span class="n">df</span><span class="o">.</span><span class="n">query</span><span class="p">(</span><span class="s1">&#39;a &lt; b and b &lt; c&#39;</span><span class="p">)</span>
</pre></div>
</div>
<p>If instead you don’t want to or cannot name your index, you can use the name
<code class="docutils literal notranslate"><span class="pre">index</span></code> in your query expression:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">randint</span><span class="p">(</span><span class="n">n</span><span class="p">,</span> <span class="n">size</span><span class="o">=</span><span class="p">(</span><span class="n">n</span><span class="p">,</span> <span class="mi">2</span><span class="p">)),</span> <span class="n">columns</span><span class="o">=</span><span class="nb">list</span><span class="p">(</span><span class="s1">&#39;bc&#39;</span><span class="p">))</span>
<span class="n">df</span>
<span class="n">df</span><span class="o">.</span><span class="n">query</span><span class="p">(</span><span class="s1">&#39;index &lt; b &lt; c&#39;</span><span class="p">)</span>
</pre></div>
</div>
<div class="admonition note">
<p class="admonition-title">备注</p>
<p>If the name of your index overlaps with a column name, the column name is
given precedence. For example,</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">({</span><span class="s1">&#39;a&#39;</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">randint</span><span class="p">(</span><span class="mi">5</span><span class="p">,</span> <span class="n">size</span><span class="o">=</span><span class="mi">5</span><span class="p">)})</span>
<span class="n">df</span><span class="o">.</span><span class="n">index</span><span class="o">.</span><span class="n">name</span> <span class="o">=</span> <span class="s1">&#39;a&#39;</span>
<span class="n">df</span><span class="o">.</span><span class="n">query</span><span class="p">(</span><span class="s1">&#39;a &gt; 2&#39;</span><span class="p">)</span>  <span class="c1"># uses the column &#39;a&#39;, not the index</span>
</pre></div>
</div>
<p>You can still use the index in a query expression by using the special
identifier ‘index’:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">df</span><span class="o">.</span><span class="n">query</span><span class="p">(</span><span class="s1">&#39;index &gt; 2&#39;</span><span class="p">)</span>
</pre></div>
</div>
<p>If for some reason you have a column named <code class="docutils literal notranslate"><span class="pre">index</span></code>, then you can refer to
the index as <code class="docutils literal notranslate"><span class="pre">ilevel_0</span></code> as well, but at this point you should consider
renaming your columns to something less ambiguous.</p>
</div>
<section id="multiindex-query-syntax">
<h3><code class="xref py py-class docutils literal notranslate"><span class="pre">MultiIndex</span></code> <code class="xref py py-meth docutils literal notranslate"><span class="pre">query()</span></code> Syntax<a class="headerlink" href="#multiindex-query-syntax" title="永久链接至标题">#</a></h3>
<p>You can also use the levels of a <code class="docutils literal notranslate"><span class="pre">DataFrame</span></code> with a
<code class="xref py py-class docutils literal notranslate"><span class="pre">MultiIndex</span></code> as if they were columns in the frame:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">n</span> <span class="o">=</span> <span class="mi">10</span>
<span class="n">colors</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">choice</span><span class="p">([</span><span class="s1">&#39;red&#39;</span><span class="p">,</span> <span class="s1">&#39;green&#39;</span><span class="p">],</span> <span class="n">size</span><span class="o">=</span><span class="n">n</span><span class="p">)</span>
<span class="n">foods</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">choice</span><span class="p">([</span><span class="s1">&#39;eggs&#39;</span><span class="p">,</span> <span class="s1">&#39;ham&#39;</span><span class="p">],</span> <span class="n">size</span><span class="o">=</span><span class="n">n</span><span class="p">)</span>
<span class="n">colors</span>
<span class="n">foods</span>

<span class="n">index</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">MultiIndex</span><span class="o">.</span><span class="n">from_arrays</span><span class="p">([</span><span class="n">colors</span><span class="p">,</span> <span class="n">foods</span><span class="p">],</span> <span class="n">names</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;color&#39;</span><span class="p">,</span> <span class="s1">&#39;food&#39;</span><span class="p">])</span>
<span class="n">df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">randn</span><span class="p">(</span><span class="n">n</span><span class="p">,</span> <span class="mi">2</span><span class="p">),</span> <span class="n">index</span><span class="o">=</span><span class="n">index</span><span class="p">)</span>
<span class="n">df</span>
<span class="n">df</span><span class="o">.</span><span class="n">query</span><span class="p">(</span><span class="s1">&#39;color == &quot;red&quot;&#39;</span><span class="p">)</span>
</pre></div>
</div>
<p>If the levels of the <code class="docutils literal notranslate"><span class="pre">MultiIndex</span></code> are unnamed, you can refer to them using
special names:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">df</span><span class="o">.</span><span class="n">index</span><span class="o">.</span><span class="n">names</span> <span class="o">=</span> <span class="p">[</span><span class="kc">None</span><span class="p">,</span> <span class="kc">None</span><span class="p">]</span>
<span class="n">df</span>
<span class="n">df</span><span class="o">.</span><span class="n">query</span><span class="p">(</span><span class="s1">&#39;ilevel_0 == &quot;red&quot;&#39;</span><span class="p">)</span>
</pre></div>
</div>
<p>The convention is <code class="docutils literal notranslate"><span class="pre">ilevel_0</span></code>, which means “index level 0” for the 0th level
of the <code class="docutils literal notranslate"><span class="pre">index</span></code>.</p>
</section>
<section id="query-use-cases">
<h3><code class="xref py py-meth docutils literal notranslate"><span class="pre">query()</span></code> Use Cases<a class="headerlink" href="#query-use-cases" title="永久链接至标题">#</a></h3>
<p>A use case for <code class="xref py py-meth docutils literal notranslate"><span class="pre">query()</span></code> is when you have a collection of
<code class="xref py py-class docutils literal notranslate"><span class="pre">DataFrame</span></code> objects that have a subset of column names (or index
levels/names) in common. You can pass the same query to both frames <em>without</em>
having to specify which frame you’re interested in querying</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">rand</span><span class="p">(</span><span class="n">n</span><span class="p">,</span> <span class="mi">3</span><span class="p">),</span> <span class="n">columns</span><span class="o">=</span><span class="nb">list</span><span class="p">(</span><span class="s1">&#39;abc&#39;</span><span class="p">))</span>
<span class="n">df</span>
<span class="n">df2</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">rand</span><span class="p">(</span><span class="n">n</span> <span class="o">+</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">),</span> <span class="n">columns</span><span class="o">=</span><span class="n">df</span><span class="o">.</span><span class="n">columns</span><span class="p">)</span>
<span class="n">df2</span>
<span class="n">expr</span> <span class="o">=</span> <span class="s1">&#39;0.0 &lt;= a &lt;= c &lt;= 0.5&#39;</span>
<span class="nb">map</span><span class="p">(</span><span class="k">lambda</span> <span class="n">frame</span><span class="p">:</span> <span class="n">frame</span><span class="o">.</span><span class="n">query</span><span class="p">(</span><span class="n">expr</span><span class="p">),</span> <span class="p">[</span><span class="n">df</span><span class="p">,</span> <span class="n">df2</span><span class="p">])</span>
</pre></div>
</div>
</section>
<section id="query-python-versus-pandas-syntax-comparison">
<h3><code class="xref py py-meth docutils literal notranslate"><span class="pre">query()</span></code> Python versus pandas Syntax Comparison<a class="headerlink" href="#query-python-versus-pandas-syntax-comparison" title="永久链接至标题">#</a></h3>
<p>Full numpy-like syntax:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">randint</span><span class="p">(</span><span class="n">n</span><span class="p">,</span> <span class="n">size</span><span class="o">=</span><span class="p">(</span><span class="n">n</span><span class="p">,</span> <span class="mi">3</span><span class="p">)),</span> <span class="n">columns</span><span class="o">=</span><span class="nb">list</span><span class="p">(</span><span class="s1">&#39;abc&#39;</span><span class="p">))</span>
<span class="n">df</span>
<span class="n">df</span><span class="o">.</span><span class="n">query</span><span class="p">(</span><span class="s1">&#39;(a &lt; b) &amp; (b &lt; c)&#39;</span><span class="p">)</span>
<span class="n">df</span><span class="p">[(</span><span class="n">df</span><span class="p">[</span><span class="s1">&#39;a&#39;</span><span class="p">]</span> <span class="o">&lt;</span> <span class="n">df</span><span class="p">[</span><span class="s1">&#39;b&#39;</span><span class="p">])</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">df</span><span class="p">[</span><span class="s1">&#39;b&#39;</span><span class="p">]</span> <span class="o">&lt;</span> <span class="n">df</span><span class="p">[</span><span class="s1">&#39;c&#39;</span><span class="p">])]</span>
</pre></div>
</div>
<p>Slightly nicer by removing the parentheses (by binding making comparison
operators bind tighter than <code class="docutils literal notranslate"><span class="pre">&amp;</span></code> and <code class="docutils literal notranslate"><span class="pre">|</span></code>).</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">df</span><span class="o">.</span><span class="n">query</span><span class="p">(</span><span class="s1">&#39;a &lt; b &amp; b &lt; c&#39;</span><span class="p">)</span>
</pre></div>
</div>
<p>Use English instead of symbols:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">df</span><span class="o">.</span><span class="n">query</span><span class="p">(</span><span class="s1">&#39;a &lt; b and b &lt; c&#39;</span><span class="p">)</span>
</pre></div>
</div>
<p>Pretty close to how you might write it on paper:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">df</span><span class="o">.</span><span class="n">query</span><span class="p">(</span><span class="s1">&#39;a &lt; b &lt; c&#39;</span><span class="p">)</span>
</pre></div>
</div>
</section>
<section id="the-in-and-not-in-operators">
<h3>The <code class="docutils literal notranslate"><span class="pre">in</span></code> and <code class="docutils literal notranslate"><span class="pre">not</span> <span class="pre">in</span></code> operators<a class="headerlink" href="#the-in-and-not-in-operators" title="永久链接至标题">#</a></h3>
<p><code class="xref py py-meth docutils literal notranslate"><span class="pre">query()</span></code> also supports special use of Python’s <code class="docutils literal notranslate"><span class="pre">in</span></code> and
<code class="docutils literal notranslate"><span class="pre">not</span> <span class="pre">in</span></code> comparison operators, providing a succinct syntax for calling the
<code class="docutils literal notranslate"><span class="pre">isin</span></code> method of a <code class="docutils literal notranslate"><span class="pre">Series</span></code> or <code class="docutils literal notranslate"><span class="pre">DataFrame</span></code>.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1"># get all rows where columns &quot;a&quot; and &quot;b&quot; have overlapping values</span>
<span class="n">df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">({</span><span class="s1">&#39;a&#39;</span><span class="p">:</span> <span class="nb">list</span><span class="p">(</span><span class="s1">&#39;aabbccddeeff&#39;</span><span class="p">),</span> <span class="s1">&#39;b&#39;</span><span class="p">:</span> <span class="nb">list</span><span class="p">(</span><span class="s1">&#39;aaaabbbbcccc&#39;</span><span class="p">),</span>
                   <span class="s1">&#39;c&#39;</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">randint</span><span class="p">(</span><span class="mi">5</span><span class="p">,</span> <span class="n">size</span><span class="o">=</span><span class="mi">12</span><span class="p">),</span>
                   <span class="s1">&#39;d&#39;</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">randint</span><span class="p">(</span><span class="mi">9</span><span class="p">,</span> <span class="n">size</span><span class="o">=</span><span class="mi">12</span><span class="p">)})</span>
<span class="n">df</span>
<span class="n">df</span><span class="o">.</span><span class="n">query</span><span class="p">(</span><span class="s1">&#39;a in b&#39;</span><span class="p">)</span>

<span class="c1"># How you&#39;d do it in pure Python</span>
<span class="n">df</span><span class="p">[</span><span class="n">df</span><span class="p">[</span><span class="s1">&#39;a&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">isin</span><span class="p">(</span><span class="n">df</span><span class="p">[</span><span class="s1">&#39;b&#39;</span><span class="p">])]</span>

<span class="n">df</span><span class="o">.</span><span class="n">query</span><span class="p">(</span><span class="s1">&#39;a not in b&#39;</span><span class="p">)</span>

<span class="c1"># pure Python</span>
<span class="n">df</span><span class="p">[</span><span class="o">~</span><span class="n">df</span><span class="p">[</span><span class="s1">&#39;a&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">isin</span><span class="p">(</span><span class="n">df</span><span class="p">[</span><span class="s1">&#39;b&#39;</span><span class="p">])]</span>
</pre></div>
</div>
<p>You can combine this with other expressions for very succinct queries:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1"># rows where cols a and b have overlapping values</span>
<span class="c1"># and col c&#39;s values are less than col d&#39;s</span>
<span class="n">df</span><span class="o">.</span><span class="n">query</span><span class="p">(</span><span class="s1">&#39;a in b and c &lt; d&#39;</span><span class="p">)</span>

<span class="c1"># pure Python</span>
<span class="n">df</span><span class="p">[</span><span class="n">df</span><span class="p">[</span><span class="s1">&#39;b&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">isin</span><span class="p">(</span><span class="n">df</span><span class="p">[</span><span class="s1">&#39;a&#39;</span><span class="p">])</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">df</span><span class="p">[</span><span class="s1">&#39;c&#39;</span><span class="p">]</span> <span class="o">&lt;</span> <span class="n">df</span><span class="p">[</span><span class="s1">&#39;d&#39;</span><span class="p">])]</span>
</pre></div>
</div>
<div class="admonition note">
<p class="admonition-title">备注</p>
<p>Note that <code class="docutils literal notranslate"><span class="pre">in</span></code> and <code class="docutils literal notranslate"><span class="pre">not</span> <span class="pre">in</span></code> are evaluated in Python, since <code class="docutils literal notranslate"><span class="pre">numexpr</span></code>
has no equivalent of this operation. However, <strong>only the</strong> <code class="docutils literal notranslate"><span class="pre">in</span></code>/<code class="docutils literal notranslate"><span class="pre">not</span> <span class="pre">in</span></code>
<strong>expression itself</strong> is evaluated in vanilla Python. For example, in the
expression</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">df</span><span class="o">.</span><span class="n">query</span><span class="p">(</span><span class="s1">&#39;a in b + c + d&#39;</span><span class="p">)</span>
</pre></div>
</div>
<p><code class="docutils literal notranslate"><span class="pre">(b</span> <span class="pre">+</span> <span class="pre">c</span> <span class="pre">+</span> <span class="pre">d)</span></code> is evaluated by <code class="docutils literal notranslate"><span class="pre">numexpr</span></code> and <em>then</em> the <code class="docutils literal notranslate"><span class="pre">in</span></code>
operation is evaluated in plain Python. In general, any operations that can
be evaluated using <code class="docutils literal notranslate"><span class="pre">numexpr</span></code> will be.</p>
</div>
</section>
<section id="special-use-of-the-operator-with-list-objects">
<h3>Special use of the <code class="docutils literal notranslate"><span class="pre">==</span></code> operator with <code class="docutils literal notranslate"><span class="pre">list</span></code> objects<a class="headerlink" href="#special-use-of-the-operator-with-list-objects" title="永久链接至标题">#</a></h3>
<p>Comparing a <code class="docutils literal notranslate"><span class="pre">list</span></code> of values to a column using <code class="docutils literal notranslate"><span class="pre">==</span></code>/<code class="docutils literal notranslate"><span class="pre">!=</span></code> works similarly
to <code class="docutils literal notranslate"><span class="pre">in</span></code>/<code class="docutils literal notranslate"><span class="pre">not</span> <span class="pre">in</span></code>.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">df</span><span class="o">.</span><span class="n">query</span><span class="p">(</span><span class="s1">&#39;b == [&quot;a&quot;, &quot;b&quot;, &quot;c&quot;]&#39;</span><span class="p">)</span>

<span class="c1"># pure Python</span>
<span class="n">df</span><span class="p">[</span><span class="n">df</span><span class="p">[</span><span class="s1">&#39;b&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">isin</span><span class="p">([</span><span class="s2">&quot;a&quot;</span><span class="p">,</span> <span class="s2">&quot;b&quot;</span><span class="p">,</span> <span class="s2">&quot;c&quot;</span><span class="p">])]</span>

<span class="n">df</span><span class="o">.</span><span class="n">query</span><span class="p">(</span><span class="s1">&#39;c == [1, 2]&#39;</span><span class="p">)</span>

<span class="n">df</span><span class="o">.</span><span class="n">query</span><span class="p">(</span><span class="s1">&#39;c != [1, 2]&#39;</span><span class="p">)</span>

<span class="c1"># using in/not in</span>
<span class="n">df</span><span class="o">.</span><span class="n">query</span><span class="p">(</span><span class="s1">&#39;[1, 2] in c&#39;</span><span class="p">)</span>

<span class="n">df</span><span class="o">.</span><span class="n">query</span><span class="p">(</span><span class="s1">&#39;[1, 2] not in c&#39;</span><span class="p">)</span>

<span class="c1"># pure Python</span>
<span class="n">df</span><span class="p">[</span><span class="n">df</span><span class="p">[</span><span class="s1">&#39;c&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">isin</span><span class="p">([</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">])]</span>
</pre></div>
</div>
</section>
</section>
<section id="returning-a-view-versus-a-copy">
<span id="indexing-view-versus-copy"></span><h2>Returning a view versus a copy<a class="headerlink" href="#returning-a-view-versus-a-copy" title="永久链接至标题">#</a></h2>
<p>When setting values in a pandas object, care must be taken to avoid what is called
<code class="docutils literal notranslate"><span class="pre">chained</span> <span class="pre">indexing</span></code>. Here is an example.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">dfmi</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">([</span><span class="nb">list</span><span class="p">(</span><span class="s1">&#39;abcd&#39;</span><span class="p">),</span>
                     <span class="nb">list</span><span class="p">(</span><span class="s1">&#39;efgh&#39;</span><span class="p">),</span>
                     <span class="nb">list</span><span class="p">(</span><span class="s1">&#39;ijkl&#39;</span><span class="p">),</span>
                     <span class="nb">list</span><span class="p">(</span><span class="s1">&#39;mnop&#39;</span><span class="p">)],</span>
                    <span class="n">columns</span><span class="o">=</span><span class="n">pd</span><span class="o">.</span><span class="n">MultiIndex</span><span class="o">.</span><span class="n">from_product</span><span class="p">([[</span><span class="s1">&#39;one&#39;</span><span class="p">,</span> <span class="s1">&#39;two&#39;</span><span class="p">],</span>
                                                        <span class="p">[</span><span class="s1">&#39;first&#39;</span><span class="p">,</span> <span class="s1">&#39;second&#39;</span><span class="p">]]))</span>
<span class="n">dfmi</span>
</pre></div>
</div>
<p>Compare these two access methods:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">dfmi</span><span class="p">[</span><span class="s1">&#39;one&#39;</span><span class="p">][</span><span class="s1">&#39;second&#39;</span><span class="p">]</span>
</pre></div>
</div>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">dfmi</span><span class="o">.</span><span class="n">loc</span><span class="p">[:,</span> <span class="p">(</span><span class="s1">&#39;one&#39;</span><span class="p">,</span> <span class="s1">&#39;second&#39;</span><span class="p">)]</span>
</pre></div>
</div>
<p>These both yield the same results, so which should you use? It is instructive to understand the order
of operations on these and why method 2 (<code class="docutils literal notranslate"><span class="pre">.loc</span></code>) is much preferred over method 1 (chained <code class="docutils literal notranslate"><span class="pre">[]</span></code>).</p>
<p><code class="docutils literal notranslate"><span class="pre">dfmi['one']</span></code> selects the first level of the columns and returns a DataFrame that is singly-indexed.
Then another Python operation <code class="docutils literal notranslate"><span class="pre">dfmi_with_one['second']</span></code> selects the series indexed by <code class="docutils literal notranslate"><span class="pre">'second'</span></code>.
This is indicated by the variable <code class="docutils literal notranslate"><span class="pre">dfmi_with_one</span></code> because pandas sees these operations as separate events.
e.g. separate calls to <code class="docutils literal notranslate"><span class="pre">__getitem__</span></code>, so it has to treat them as linear operations, they happen one after another.</p>
<p>Contrast this to <code class="docutils literal notranslate"><span class="pre">df.loc[:,('one','second')]</span></code> which passes a nested tuple of <code class="docutils literal notranslate"><span class="pre">(slice(None),('one','second'))</span></code> to a single call to
<code class="docutils literal notranslate"><span class="pre">__getitem__</span></code>. This allows pandas to deal with this as a single entity. Furthermore this order of operations <em>can</em> be significantly
faster, and allows one to index <em>both</em> axes if so desired.</p>
<section id="why-does-assignment-fail-when-using-chained-indexing">
<h3>Why does assignment fail when using chained indexing?<a class="headerlink" href="#why-does-assignment-fail-when-using-chained-indexing" title="永久链接至标题">#</a></h3>
<p>The problem in the previous section is just a performance issue. What’s up with
the <code class="docutils literal notranslate"><span class="pre">SettingWithCopy</span></code> warning? We don’t <strong>usually</strong> throw warnings around when
you do something that might cost a few extra milliseconds!</p>
<p>But it turns out that assigning to the product of chained indexing has
inherently unpredictable results. To see this, think about how the Python
interpreter executes this code:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">value</span> <span class="o">=</span> <span class="kc">None</span>
</pre></div>
</div>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">dfmi</span><span class="o">.</span><span class="n">loc</span><span class="p">[:,</span> <span class="p">(</span><span class="s1">&#39;one&#39;</span><span class="p">,</span> <span class="s1">&#39;second&#39;</span><span class="p">)]</span> <span class="o">=</span> <span class="n">value</span>
<span class="c1"># becomes</span>
<span class="n">dfmi</span><span class="o">.</span><span class="n">loc</span><span class="o">.</span><span class="fm">__setitem__</span><span class="p">((</span><span class="nb">slice</span><span class="p">(</span><span class="kc">None</span><span class="p">),</span> <span class="p">(</span><span class="s1">&#39;one&#39;</span><span class="p">,</span> <span class="s1">&#39;second&#39;</span><span class="p">)),</span> <span class="n">value</span><span class="p">)</span>
</pre></div>
</div>
<p>But this code is handled differently:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">dfmi</span><span class="p">[</span><span class="s1">&#39;one&#39;</span><span class="p">][</span><span class="s1">&#39;second&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">value</span>
<span class="c1"># becomes</span>
<span class="n">dfmi</span><span class="o">.</span><span class="fm">__getitem__</span><span class="p">(</span><span class="s1">&#39;one&#39;</span><span class="p">)</span><span class="o">.</span><span class="fm">__setitem__</span><span class="p">(</span><span class="s1">&#39;second&#39;</span><span class="p">,</span> <span class="n">value</span><span class="p">)</span>
</pre></div>
</div>
<p>See that <code class="docutils literal notranslate"><span class="pre">__getitem__</span></code> in there? Outside of simple cases, it’s very hard to
predict whether it will return a view or a copy (it depends on the memory layout
of the array, about which pandas makes no guarantees), and therefore whether
the <code class="docutils literal notranslate"><span class="pre">__setitem__</span></code> will modify <code class="docutils literal notranslate"><span class="pre">dfmi</span></code> or a temporary object that gets thrown
out immediately afterward. <strong>That’s</strong> what <code class="docutils literal notranslate"><span class="pre">SettingWithCopy</span></code> is warning you
about!</p>
<div class="admonition note">
<p class="admonition-title">备注</p>
<p>You may be wondering whether we should be concerned about the <code class="docutils literal notranslate"><span class="pre">loc</span></code>
property in the first example. But <code class="docutils literal notranslate"><span class="pre">dfmi.loc</span></code> is guaranteed to be <code class="docutils literal notranslate"><span class="pre">dfmi</span></code>
itself with modified indexing behavior, so <code class="docutils literal notranslate"><span class="pre">dfmi.loc.__getitem__</span></code> /
<code class="docutils literal notranslate"><span class="pre">dfmi.loc.__setitem__</span></code> operate on <code class="docutils literal notranslate"><span class="pre">dfmi</span></code> directly. Of course,
<code class="docutils literal notranslate"><span class="pre">dfmi.loc.__getitem__(idx)</span></code> may be a view or a copy of <code class="docutils literal notranslate"><span class="pre">dfmi</span></code>.</p>
</div>
<p>Sometimes a <code class="docutils literal notranslate"><span class="pre">SettingWithCopy</span></code> warning will arise at times when there’s no
obvious chained indexing going on. <strong>These</strong> are the bugs that
<code class="docutils literal notranslate"><span class="pre">SettingWithCopy</span></code> is designed to catch! Pandas is probably trying to warn you
that you’ve done this:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">do_something</span><span class="p">(</span><span class="n">df</span><span class="p">):</span>
    <span class="n">foo</span> <span class="o">=</span> <span class="n">df</span><span class="p">[[</span><span class="s1">&#39;bar&#39;</span><span class="p">,</span> <span class="s1">&#39;baz&#39;</span><span class="p">]]</span>  <span class="c1"># Is foo a view? A copy? Nobody knows!</span>
    <span class="c1"># ... many lines here ...</span>
    <span class="c1"># We don&#39;t know whether this will modify df or not!</span>
    <span class="n">foo</span><span class="p">[</span><span class="s1">&#39;quux&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">value</span>
    <span class="k">return</span> <span class="n">foo</span>
</pre></div>
</div>
<p>Yikes!</p>
</section>
<section id="evaluation-order-matters">
<span id="indexing-evaluation-order"></span><h3>Evaluation order matters<a class="headerlink" href="#evaluation-order-matters" title="永久链接至标题">#</a></h3>
<p>When you use chained indexing, the order and type of the indexing operation
partially determine whether the result is a slice into the original object, or
a copy of the slice.</p>
<p>Pandas has the <code class="docutils literal notranslate"><span class="pre">SettingWithCopyWarning</span></code> because assigning to a copy of a
slice is frequently not intentional, but a mistake caused by chained indexing
returning a copy where a slice was expected.</p>
<p>If you would like pandas to be more or less trusting about assignment to a
chained indexing expression, you can set the option
<code class="docutils literal notranslate"><span class="pre">mode.chained_assignment</span></code> to one of these values:</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">'warn'</span></code>, the default, means a <code class="docutils literal notranslate"><span class="pre">SettingWithCopyWarning</span></code> is printed.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">'raise'</span></code> means pandas will raise a <code class="docutils literal notranslate"><span class="pre">SettingWithCopyException</span></code>
you have to deal with.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">None</span></code> will suppress the warnings entirely.</p></li>
</ul>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">dfb</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">({</span><span class="s1">&#39;a&#39;</span><span class="p">:</span> <span class="p">[</span><span class="s1">&#39;one&#39;</span><span class="p">,</span> <span class="s1">&#39;one&#39;</span><span class="p">,</span> <span class="s1">&#39;two&#39;</span><span class="p">,</span>
                          <span class="s1">&#39;three&#39;</span><span class="p">,</span> <span class="s1">&#39;two&#39;</span><span class="p">,</span> <span class="s1">&#39;one&#39;</span><span class="p">,</span> <span class="s1">&#39;six&#39;</span><span class="p">],</span>
                    <span class="s1">&#39;c&#39;</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mi">7</span><span class="p">)})</span>

<span class="c1"># This will show the SettingWithCopyWarning</span>
<span class="c1"># but the frame values will be set</span>
<span class="n">dfb</span><span class="p">[</span><span class="s1">&#39;c&#39;</span><span class="p">][</span><span class="n">dfb</span><span class="p">[</span><span class="s1">&#39;a&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">str</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s1">&#39;o&#39;</span><span class="p">)]</span> <span class="o">=</span> <span class="mi">42</span>
</pre></div>
</div>
<p>This however is operating on a copy and will not work.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">pd</span><span class="o">.</span><span class="n">set_option</span><span class="p">(</span><span class="s1">&#39;mode.chained_assignment&#39;</span><span class="p">,</span><span class="s1">&#39;warn&#39;</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">dfb</span><span class="p">[</span><span class="n">dfb</span><span class="p">[</span><span class="s1">&#39;a&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">str</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s1">&#39;o&#39;</span><span class="p">)][</span><span class="s1">&#39;c&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">42</span>
<span class="go">Traceback (most recent call last)</span>
<span class="go">     ...</span>
<span class="go">SettingWithCopyWarning:</span>
<span class="go">     A value is trying to be set on a copy of a slice from a DataFrame.</span>
<span class="go">     Try using .loc[row_index,col_indexer] = value instead</span>
</pre></div>
</div>
<p>A chained assignment can also crop up in setting in a mixed dtype frame.</p>
<div class="admonition note">
<p class="admonition-title">备注</p>
<p>These setting rules apply to all of <code class="docutils literal notranslate"><span class="pre">.loc/.iloc</span></code>.</p>
</div>
<p>This is the correct access method:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">dfc</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">({</span><span class="s1">&#39;A&#39;</span><span class="p">:</span> <span class="p">[</span><span class="s1">&#39;aaa&#39;</span><span class="p">,</span> <span class="s1">&#39;bbb&#39;</span><span class="p">,</span> <span class="s1">&#39;ccc&#39;</span><span class="p">],</span> <span class="s1">&#39;B&#39;</span><span class="p">:</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">]})</span>
<span class="n">dfc</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="s1">&#39;A&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">11</span>
<span class="n">dfc</span>
</pre></div>
</div>
<p>This <em>can</em> work at times, but it is not guaranteed to, and therefore should be avoided:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">dfc</span> <span class="o">=</span> <span class="n">dfc</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
<span class="n">dfc</span><span class="p">[</span><span class="s1">&#39;A&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="mi">111</span>
<span class="n">dfc</span>
</pre></div>
</div>
<p>This will <strong>not</strong> work at all, and so should be avoided:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">pd</span><span class="o">.</span><span class="n">set_option</span><span class="p">(</span><span class="s1">&#39;mode.chained_assignment&#39;</span><span class="p">,</span><span class="s1">&#39;raise&#39;</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">dfc</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="s1">&#39;A&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">1111</span>
<span class="go">Traceback (most recent call last)</span>
<span class="go">     ...</span>
<span class="go">SettingWithCopyException:</span>
<span class="go">     A value is trying to be set on a copy of a slice from a DataFrame.</span>
<span class="go">     Try using .loc[row_index,col_indexer] = value instead</span>
</pre></div>
</div>
<div class="admonition warning">
<p class="admonition-title">警告</p>
<p>The chained assignment warnings / exceptions are aiming to inform the user of a possibly invalid
assignment. There may be false positives; situations where a chained assignment is inadvertently
reported.</p>
</div>
</section>
</section>
</section>


              </div>
              
              
              <!-- Previous / next buttons -->
<div class='prev-next-area'>
    <a class='left-prev' id="prev-link" href="generated/pandas.Series.array.html" title="上一页 页">
        <i class="fas fa-angle-left"></i>
        <div class="prev-next-info">
            <p class="prev-next-subtitle">上一页</p>
            <p class="prev-next-title">pandas.Series.array</p>
        </div>
    </a>
    <a class='right-next' id="next-link" href="no-sidebar.html" title="下一页 页">
    <div class="prev-next-info">
        <p class="prev-next-subtitle">下一页</p>
        <p class="prev-next-title"><span class="section-number">1. </span>Test of no sidebar</p>
    </div>
    <i class="fas fa-angle-right"></i>
    </a>
</div>
              
          </main>
          

      </div>
    </div>
  
  <!-- Scripts loaded after <body> so the DOM is not blocked -->
  <script src="../_static/scripts/pydata-sphinx-theme.js?digest=fb52004a9691e5b75515"></script>
<footer class="footer mt-5 mt-md-0">
  <div class="container">
    
    <div class="footer-item">
      <p class="copyright">
    &copy; Copyright 2019, PyData Community.<br>
</p>
    </div>
    
    <div class="footer-item">
      <p class="sphinx-version">
Created using <a href="http://sphinx-doc.org/">Sphinx</a> 4.5.0.<br>
</p>
    </div>
    
  </div>
</footer>
  </body>
</html>